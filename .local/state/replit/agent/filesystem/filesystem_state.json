{"file_contents":{"manage.py":{"content":"#!/usr/bin/env python\n\"\"\"Django's command-line utility for administrative tasks.\"\"\"\nimport os\nimport sys\n\n\ndef main():\n    \"\"\"Run administrative tasks.\"\"\"\n    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'escola_sistema.settings')\n    try:\n        from django.core.management import execute_from_command_line\n    except ImportError as exc:\n        raise ImportError(\n            \"Couldn't import Django. Are you sure it's installed and \"\n            \"available on your PYTHONPATH environment variable? Did you \"\n            \"forget to activate a virtual environment?\"\n        ) from exc\n    execute_from_command_line(sys.argv)\n\n\nif __name__ == '__main__':\n    main()\n","size_bytes":670},"pyproject.toml":{"content":"[project]\nname = \"repl-nix-workspace\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nrequires-python = \">=3.11\"\ndependencies = [\n    \"django>=5.2.7\",\n    \"reportlab>=4.4.4\",\n]\n","size_bytes":189},"replit.md":{"content":"# Overview\n\nThis is SIGA (Sistema Integral de Gestão Académica), a comprehensive Django-based school management system designed for Angolan academic institutions. The application manages the complete enrollment lifecycle from student registration through exam scoring to admission approval based on grades and available seats.\n\n## Core Features\n\n- **Course Management**: Administrators can create and manage courses with configurable enrollment capacity and minimum passing grades\n- **Student Enrollment**: Multi-step wizard enrollment form with progress tracking (4 stages: Personal, Academic, Financial, Guardian)\n- **Automated Admission Processing**: System automatically approves students based on test scores and available seats\n- **Result Consultation**: Students can check enrollment status using their registration number\n- **PDF Generation**: Automatic generation of enrollment confirmation documents\n- **Dashboard Analytics**: Administrative dashboard showing enrollment statistics and course metrics\n- **School Database**: Autocomplete search for schools with quick registration option\n- **Smart Validations**: BI expiration check, automatic age calculation, and birth date validation\n- **User Authentication System**: Custom login, registration, and logout with personalized greetings. Login obrigatório para acessar o sistema\n- **User Access Levels**: Profile system with roles (Admin, Secretaria, Professor, Coordenador, Aluno)\n- **Profile Assignment System**: New registrations require admin approval. Profiles start as \"Pendente\" and admin assigns appropriate role before user can access system\n- **Notification System**: Important notifications with badges, real-time count updates, and read/unread status\n- **Personalized UI**: User greeting in navbar with contextual time-based salutation (Bom dia 5h-12h/Boa tarde 12h-18h/Boa noite 18h-5h)\n- **Subscription Management**: Monthly/annual subscription plans with expiration tracking, status display in login and footer\n- **SIGA Branding**: Full system branding with logo, version v1.0.0, developer credit (Eng. Osvaldo Queta), and subscription status in footer\n- **Subscription Renewal System**: Complete payment workflow with admin approval, PDF receipt generation, and automatic subscription extension\n- **Login Protection**: System blocks login when subscription expires, displaying appropriate error message and renewal option\n- **Payment Processing**: Public page for payment submission with voucher upload, admin approval/rejection, automatic PDF receipt generation\n- **Password Recovery System**: Dual-method password recovery with SMS OTP (6-digit code, 10-minute validity) and email link (1-hour validity). Token-based system with automatic expiration and single-use tokens\n- **Advanced Security Validations**: \n  - Duplicate profile protection with error handling and notification messages\n  - System-wide unique password enforcement - no two users can have the same password regardless of username\n  - Password uniqueness validated during registration and password recovery (both OTP and email methods)\n  - Unique email enforcement - no two users can share the same email address\n  - Unique phone number enforcement - no two user profiles can share the same phone number\n  - Unique BI (Bilhete de Identidade) enforcement in enrollments - no duplicate identity documents allowed\n  - Unique email and phone validation in enrollment system to prevent duplicate student registrations\n\n# User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n# System Architecture\n\n## Framework & Technology Stack\n\n**Django 5.2.7** serves as the core web framework, chosen for its robust admin interface, ORM capabilities, and built-in security features. The application follows Django's Model-View-Template (MVT) architecture pattern.\n\n**Key Design Decisions:**\n\n- **Monolithic Architecture**: Single Django application for simplicity and ease of deployment\n- **Template-based Frontend**: Server-side rendered HTML using Bootstrap 5 for responsive UI\n- **SQLite Database** (default): Suitable for development; can be upgraded to PostgreSQL for production\n- **ReportLab Integration**: For generating PDF documents with school branding\n\n## Data Model Architecture\n\n### Core Entities\n\n1. **ConfiguracaoEscola (School Configuration)**\n   - Singleton pattern implementation (only one configuration allowed)\n   - Stores school identity, contact info, logo, and document templates\n   - Prevents deletion and duplicate creation through admin permissions\n\n2. **Curso (Course)**\n   - Tracks course details, available seats, and minimum passing grade\n   - Includes soft-delete via `ativo` (active) flag\n   - Computed properties for available seats and enrollment counts\n\n3. **Inscricao (Enrollment)**\n   - Auto-generated unique registration numbers (INS-XXXXXX format)\n   - Stores comprehensive student data across 4 categories: Personal, Academic, Financial, Guardian\n   - Personal info includes BI number with expiration date validation\n   - Academic info links to Escola (School) model via ForeignKey\n   - Financial info stores payment voucher number (text field, not file upload)\n   - Guardian info for parent/tutor contacts and employment details\n   - Automated age calculation and birthday tracking methods\n   - Boolean approval status determined by automated processing\n\n4. **Escola (School)**\n   - Database of schools for enrollment forms\n   - Supports autocomplete search and quick registration\n   - Tracks school name, municipality, province, and type (public/private)\n\n5. **Additional Models** (fully implemented)\n   - Disciplina (Subject): Links to courses with workload hours and descriptions\n   - Professor (Teacher): Faculty management with specialties and contract dates\n   - Turma (Class): Class/section organization with year and assigned teachers\n   - Aluno (Student): Enrolled student records with auto-generated student numbers (ALU-XXXXXX)\n   - Pai (Parent): Parent/guardian information with many-to-many relationship to students\n\n6. **RecuperacaoSenha (Password Recovery)**\n   - Token-based password recovery system with dual methods (SMS/email)\n   - Auto-generated unique tokens for email recovery (UUID format)\n   - Random 6-digit OTP codes for phone recovery\n   - Configurable expiration times (10 minutes for OTP, 60 minutes for email)\n   - Tracks recovery method, usage status, and phone/email destinations\n   - Automatic cleanup of expired/used tokens\n\n### Approval Logic\n\nThe `processar_aprovacoes_curso()` function implements a merit-based admission system:\n- Filters enrollments with test scores meeting minimum grade\n- Orders by test score (descending)\n- Approves top N students where N = available seats\n- Automatically rejects others\n\n## Application Flow\n\n1. **Public Access**: Students browse available courses and submit multi-step enrollment forms\n2. **Enrollment Wizard**: Progressive 4-step form with validations:\n   - Step 1 (Personal): BI expiration validation, automatic age/birthday calculation\n   - Step 2 (Academic): School autocomplete search with quick-add modal\n   - Step 3 (Financial): Payment voucher number entry\n   - Step 4 (Guardian): Parent/tutor information\n3. **Registration**: System generates unique enrollment ID and stores student data\n4. **Testing**: Admin staff enter test scores through Django admin\n5. **Processing**: Automated approval based on grades and seat availability\n6. **Results**: Students query their status using enrollment number\n7. **Documentation**: PDF confirmation generation with school template\n\n## Security & Permissions\n\n- CSRF protection enabled via Django middleware\n- Admin-only access for course management and grade entry\n- Public access restricted to enrollment submission and status checking\n- Secret key configured (needs environment variable in production)\n- DEBUG mode currently enabled (must disable for production)\n\n## Static & Media Handling\n\n- Bootstrap 5 CDN for styling\n- Custom CSS with gradient themes and card animations\n- Media uploads for school logos stored in `MEDIA_ROOT`\n- Static file serving via Django's built-in handler\n\n# External Dependencies\n\n## Python Packages\n\n- **Django 5.2.7**: Web framework\n- **ReportLab**: PDF generation library for enrollment confirmations and reports\n- **Pillow** (implied): Image processing for school logo uploads\n\n## Frontend Libraries\n\n- **Bootstrap 5.3.0**: CSS framework loaded via CDN for responsive design\n- Custom inline CSS for theming and animations\n\n## Database\n\n- **SQLite** (default): Django's default database for development\n- Schema managed through Django ORM and migrations\n- Can be migrated to PostgreSQL, MySQL, or other production databases\n\n## File Storage\n\n- Local filesystem for media uploads (school logos)\n- PDF documents generated in-memory using BytesIO\n\n## Infrastructure Services\n\n- **WSGI/ASGI**: Standard Django deployment interfaces configured\n- **Static/Media URL patterns**: Configured for development with Django's static file serving\n\n## Authentication\n\n- Django's built-in authentication system\n- Admin interface using Django's default User model\n- No external authentication providers configured","size_bytes":9150},"core/__init__.py":{"content":"","size_bytes":0},"core/admin.py":{"content":"from django.contrib import admin\nfrom .models import ConfiguracaoEscola, Curso, Disciplina, Escola, Inscricao, Professor, Turma, Aluno, Pai, AnoAcademico, PerfilUsuario, Notificacao, Subscricao, PagamentoSubscricao, RecuperacaoSenha\n\n@admin.register(AnoAcademico)\nclass AnoAcademicoAdmin(admin.ModelAdmin):\n    list_display = ['__str__', 'ano_inicio', 'ano_fim', 'ativo', 'data_criacao']\n    list_filter = ['ativo', 'data_criacao']\n    ordering = ['-ano_inicio']\n    \n    actions = ['marcar_como_ativo']\n    \n    def marcar_como_ativo(self, request, queryset):\n        # Desativar todos\n        AnoAcademico.objects.all().update(ativo=False)\n        # Ativar o primeiro selecionado\n        if queryset.exists():\n            ano = queryset.first()\n            ano.ativo = True\n            ano.save()\n            self.message_user(request, f\"Ano acadêmico {ano} marcado como ativo!\")\n    marcar_como_ativo.short_description = \"Marcar como ano ativo\"\n\n@admin.register(ConfiguracaoEscola)\nclass ConfiguracaoEscolaAdmin(admin.ModelAdmin):\n    list_display = ['nome_escola', 'telefone', 'email']\n    fieldsets = (\n        ('Informações Básicas', {\n            'fields': ('nome_escola', 'endereco', 'telefone', 'email', 'logo')\n        }),\n        ('Templates de Documentos', {\n            'fields': ('template_confirmacao_inscricao',)\n        }),\n    )\n    \n    def has_add_permission(self, request):\n        if ConfiguracaoEscola.objects.exists():\n            return False\n        return super().has_add_permission(request)\n    \n    def has_delete_permission(self, request, obj=None):\n        return False\n\n@admin.register(Curso)\nclass CursoAdmin(admin.ModelAdmin):\n    list_display = ['nome', 'vagas', 'vagas_disponiveis', 'nota_minima', 'ativo', 'total_inscricoes']\n    list_filter = ['ativo', 'data_criacao']\n    search_fields = ['nome', 'descricao']\n    readonly_fields = ['data_criacao']\n\n@admin.register(Disciplina)\nclass DisciplinaAdmin(admin.ModelAdmin):\n    list_display = ['nome', 'curso', 'carga_horaria']\n    list_filter = ['curso']\n    search_fields = ['nome', 'curso__nome']\n\n@admin.register(Escola)\nclass EscolaAdmin(admin.ModelAdmin):\n    list_display = ['nome', 'municipio', 'provincia', 'tipo', 'data_cadastro']\n    list_filter = ['tipo', 'provincia']\n    search_fields = ['nome', 'municipio', 'provincia']\n    readonly_fields = ['data_cadastro']\n\n@admin.register(Inscricao)\nclass InscricaoAdmin(admin.ModelAdmin):\n    list_display = ['numero_inscricao', 'nome_completo', 'curso', 'nota_teste', 'aprovado', 'data_inscricao']\n    list_filter = ['curso', 'aprovado', 'data_inscricao']\n    search_fields = ['numero_inscricao', 'nome_completo', 'bilhete_identidade', 'email']\n    readonly_fields = ['numero_inscricao', 'data_inscricao', 'data_resultado']\n    fieldsets = (\n        ('Informações da Inscrição', {\n            'fields': ('numero_inscricao', 'curso', 'data_inscricao')\n        }),\n        ('Dados Pessoais', {\n            'fields': ('nome_completo', 'data_nascimento', 'sexo', 'bilhete_identidade')\n        }),\n        ('Contato', {\n            'fields': ('telefone', 'email', 'endereco')\n        }),\n        ('Avaliação', {\n            'fields': ('nota_teste', 'aprovado', 'data_resultado')\n        }),\n    )\n    \n    actions = ['processar_aprovacao']\n    \n    def processar_aprovacao(self, request, queryset):\n        from .views import processar_aprovacoes_curso\n        cursos = queryset.values_list('curso', flat=True).distinct()\n        for curso_id in cursos:\n            processar_aprovacoes_curso(curso_id)\n        self.message_user(request, \"Aprovações processadas com sucesso!\")\n    processar_aprovacao.short_description = \"Processar aprovação automática\"\n\n@admin.register(Professor)\nclass ProfessorAdmin(admin.ModelAdmin):\n    list_display = ['nome_completo', 'bilhete_identidade', 'especialidade', 'telefone', 'email']\n    search_fields = ['nome_completo', 'bilhete_identidade', 'especialidade']\n    list_filter = ['sexo', 'data_contratacao']\n\n@admin.register(Turma)\nclass TurmaAdmin(admin.ModelAdmin):\n    list_display = ['nome', 'curso', 'ano_letivo', 'professor_titular']\n    list_filter = ['curso', 'ano_letivo']\n    search_fields = ['nome', 'curso__nome']\n\n@admin.register(Aluno)\nclass AlunoAdmin(admin.ModelAdmin):\n    list_display = ['numero_estudante', 'nome_completo', 'turma', 'telefone', 'email']\n    list_filter = ['turma', 'sexo', 'data_matricula']\n    search_fields = ['numero_estudante', 'nome_completo', 'bilhete_identidade']\n    readonly_fields = ['numero_estudante', 'data_matricula']\n\n@admin.register(Pai)\nclass PaiAdmin(admin.ModelAdmin):\n    list_display = ['nome_completo', 'parentesco', 'telefone', 'email']\n    search_fields = ['nome_completo', 'bilhete_identidade']\n    filter_horizontal = ['alunos']\n\n@admin.register(PerfilUsuario)\nclass PerfilUsuarioAdmin(admin.ModelAdmin):\n    list_display = ['user', 'nivel_acesso', 'telefone', 'ativo', 'data_cadastro', 'status_badge']\n    list_filter = ['nivel_acesso', 'ativo', 'data_cadastro']\n    search_fields = ['user__username', 'user__first_name', 'user__last_name', 'telefone']\n    readonly_fields = ['data_cadastro']\n    list_editable = ['nivel_acesso']\n    \n    def status_badge(self, obj):\n        if obj.nivel_acesso == 'pendente':\n            return '⏳ Aguardando Atribuição'\n        return '✅ Atribuído'\n    status_badge.short_description = 'Status'\n\n@admin.register(Notificacao)\nclass NotificacaoAdmin(admin.ModelAdmin):\n    list_display = ['titulo', 'tipo', 'global_notificacao', 'ativa', 'data_criacao']\n    list_filter = ['tipo', 'global_notificacao', 'ativa', 'data_criacao']\n    search_fields = ['titulo', 'mensagem']\n    filter_horizontal = ['destinatarios', 'lida_por']\n    readonly_fields = ['data_criacao']\n    fieldsets = (\n        ('Informações da Notificação', {\n            'fields': ('titulo', 'mensagem', 'tipo', 'ativa')\n        }),\n        ('Destinatários', {\n            'fields': ('global_notificacao', 'destinatarios', 'lida_por')\n        }),\n        ('Metadata', {\n            'fields': ('data_criacao',)\n        }),\n    )\n\n@admin.register(Subscricao)\nclass SubscricaoAdmin(admin.ModelAdmin):\n    list_display = ['nome_escola', 'plano', 'estado', 'data_inicio', 'data_expiracao', 'dias_restantes', 'esta_ativo']\n    list_filter = ['plano', 'estado', 'data_inicio', 'data_expiracao']\n    search_fields = ['nome_escola', 'observacoes']\n    readonly_fields = ['data_criacao', 'dias_restantes', 'percentual_usado', 'esta_ativo']\n    fieldsets = (\n        ('Informações da Escola', {\n            'fields': ('nome_escola',)\n        }),\n        ('Dados da Subscrição', {\n            'fields': ('plano', 'estado', 'data_inicio', 'data_expiracao', 'valor_pago')\n        }),\n        ('Status', {\n            'fields': ('dias_restantes', 'percentual_usado', 'esta_ativo')\n        }),\n        ('Observações', {\n            'fields': ('observacoes', 'data_criacao')\n        }),\n    )\n\n@admin.register(PagamentoSubscricao)\nclass PagamentoSubscricaoAdmin(admin.ModelAdmin):\n    list_display = ['id', 'subscricao', 'plano_escolhido', 'valor', 'data_pagamento', 'status', 'data_submissao']\n    list_filter = ['status', 'plano_escolhido', 'data_pagamento', 'data_submissao']\n    search_fields = ['subscricao__nome_escola', 'numero_referencia', 'observacoes']\n    readonly_fields = ['data_submissao', 'aprovado_por', 'data_aprovacao', 'recibo_pdf']\n    \n    fieldsets = (\n        ('Informações do Pagamento', {\n            'fields': ('subscricao', 'plano_escolhido', 'valor', 'data_pagamento', 'numero_referencia')\n        }),\n        ('Comprovante', {\n            'fields': ('comprovante',)\n        }),\n        ('Status', {\n            'fields': ('status', 'observacoes')\n        }),\n        ('Aprovação', {\n            'fields': ('aprovado_por', 'data_aprovacao', 'recibo_pdf', 'data_submissao')\n        }),\n    )\n    \n    actions = ['aprovar_pagamentos', 'rejeitar_pagamentos']\n    \n    def aprovar_pagamentos(self, request, queryset):\n        from datetime import datetime, timedelta\n        from django.utils import timezone\n        from .utils import gerar_recibo_pagamento\n        \n        count = 0\n        for pagamento in queryset.filter(status='pendente'):\n            pagamento.status = 'aprovado'\n            pagamento.aprovado_por = request.user\n            pagamento.data_aprovacao = timezone.now()\n            \n            subscricao = pagamento.subscricao\n            if pagamento.plano_escolhido == 'mensal':\n                dias = 30\n            elif pagamento.plano_escolhido == 'anual':\n                dias = 365\n            else:\n                dias = 30\n            \n            if subscricao.esta_ativo():\n                subscricao.data_expiracao = subscricao.data_expiracao + timedelta(days=dias)\n            else:\n                subscricao.data_inicio = datetime.now().date()\n                subscricao.data_expiracao = datetime.now().date() + timedelta(days=dias)\n            \n            subscricao.plano = pagamento.plano_escolhido\n            subscricao.estado = 'ativo'\n            subscricao.valor_pago = pagamento.valor\n            subscricao.save()\n            \n            recibo_path = gerar_recibo_pagamento(pagamento)\n            if recibo_path:\n                pagamento.recibo_pdf = recibo_path\n            \n            pagamento.save()\n            count += 1\n        \n        self.message_user(request, f'{count} pagamento(s) aprovado(s) com sucesso!')\n    aprovar_pagamentos.short_description = \"Aprovar pagamentos selecionados\"\n    \n    def rejeitar_pagamentos(self, request, queryset):\n        from django.utils import timezone\n        \n        count = queryset.filter(status='pendente').update(\n            status='rejeitado',\n            aprovado_por=request.user,\n            data_aprovacao=timezone.now()\n        )\n        self.message_user(request, f'{count} pagamento(s) rejeitado(s)!')\n    rejeitar_pagamentos.short_description = \"Rejeitar pagamentos selecionados\"\n\n@admin.register(RecuperacaoSenha)\nclass RecuperacaoSenhaAdmin(admin.ModelAdmin):\n    list_display = ['user', 'tipo', 'usado', 'esta_expirado', 'data_criacao', 'data_expiracao']\n    list_filter = ['tipo', 'usado', 'data_criacao']\n    search_fields = ['user__username', 'email_enviado', 'telefone_enviado']\n    readonly_fields = ['data_criacao']\n","size_bytes":10319},"core/apps.py":{"content":"from django.apps import AppConfig\n\n\nclass CoreConfig(AppConfig):\n    default_auto_field = 'django.db.models.BigAutoField'\n    name = 'core'\n    \n    def ready(self):\n        import core.signals\n","size_bytes":194},"core/models.py":{"content":"from django.db import models\nfrom django.contrib.auth.models import User\nfrom django.core.validators import MinValueValidator, MaxValueValidator\nfrom django.utils import timezone\n\nclass AnoAcademico(models.Model):\n    ano_inicio = models.IntegerField(verbose_name=\"Ano de Início\")\n    ano_fim = models.IntegerField(verbose_name=\"Ano de Fim\")\n    ativo = models.BooleanField(default=False, verbose_name=\"Ano Ativo\")\n    data_criacao = models.DateTimeField(auto_now_add=True)\n    \n    class Meta:\n        verbose_name = \"Ano Acadêmico\"\n        verbose_name_plural = \"Anos Acadêmicos\"\n        ordering = ['-ano_inicio']\n        unique_together = ['ano_inicio', 'ano_fim']\n    \n    def __str__(self):\n        return f\"{self.ano_inicio}/{self.ano_fim}\"\n    \n    def save(self, *args, **kwargs):\n        # Se este ano for marcado como ativo, desativar todos os outros\n        if self.ativo:\n            AnoAcademico.objects.exclude(pk=self.pk).update(ativo=False)\n        super().save(*args, **kwargs)\n\nclass ConfiguracaoEscola(models.Model):\n    nome_escola = models.CharField(max_length=200, verbose_name=\"Nome da Escola\")\n    endereco = models.TextField(blank=True, verbose_name=\"Endereço\")\n    telefone = models.CharField(max_length=20, blank=True, verbose_name=\"Telefone\")\n    email = models.EmailField(blank=True, verbose_name=\"Email\")\n    logo = models.ImageField(upload_to='escola/', blank=True, null=True, verbose_name=\"Logo da Escola\")\n    \n    template_confirmacao_inscricao = models.TextField(\n        default=\"CONFIRMAÇÃO DE INSCRIÇÃO\\n\\nNome: {nome}\\nCurso: {curso}\\nNúmero de Inscrição: {numero}\\nData: {data}\",\n        verbose_name=\"Template de Confirmação de Inscrição\",\n        help_text=\"Use {nome}, {curso}, {numero}, {data} para campos dinâmicos\"\n    )\n    \n    class Meta:\n        verbose_name = \"Configuração da Escola\"\n        verbose_name_plural = \"Configurações da Escola\"\n    \n    def __str__(self):\n        return self.nome_escola\n    \n    def save(self, *args, **kwargs):\n        if not self.pk and ConfiguracaoEscola.objects.exists():\n            raise ValueError('Só pode existir uma configuração de escola')\n        return super().save(*args, **kwargs)\n\nclass Curso(models.Model):\n    nome = models.CharField(max_length=200, verbose_name=\"Nome do Curso\")\n    descricao = models.TextField(blank=True, verbose_name=\"Descrição\")\n    vagas = models.PositiveIntegerField(verbose_name=\"Número de Vagas\")\n    nota_minima = models.DecimalField(\n        max_digits=4, \n        decimal_places=2, \n        default=10.00,\n        validators=[MinValueValidator(10.00), MaxValueValidator(20.00)],\n        verbose_name=\"Nota Mínima para Aprovação\"\n    )\n    ativo = models.BooleanField(default=True, verbose_name=\"Ativo\")\n    data_criacao = models.DateTimeField(auto_now_add=True)\n    \n    class Meta:\n        verbose_name = \"Curso\"\n        verbose_name_plural = \"Cursos\"\n        ordering = ['nome']\n    \n    def __str__(self):\n        return self.nome\n    \n    def vagas_disponiveis(self):\n        aprovados = self.inscricoes.filter(aprovado=True).count()\n        return max(0, self.vagas - aprovados)\n    \n    def total_inscricoes(self):\n        return self.inscricoes.count()\n\nclass Disciplina(models.Model):\n    curso = models.ForeignKey(Curso, on_delete=models.CASCADE, related_name='disciplinas', verbose_name=\"Curso\")\n    nome = models.CharField(max_length=200, verbose_name=\"Nome da Disciplina\")\n    carga_horaria = models.PositiveIntegerField(verbose_name=\"Carga Horária (horas)\", default=40)\n    descricao = models.TextField(blank=True, verbose_name=\"Descrição\")\n    \n    class Meta:\n        verbose_name = \"Disciplina\"\n        verbose_name_plural = \"Disciplinas\"\n        ordering = ['curso', 'nome']\n    \n    def __str__(self):\n        return f\"{self.nome} - {self.curso.nome}\"\n\nclass Escola(models.Model):\n    nome = models.CharField(max_length=300, verbose_name=\"Nome da Escola\", unique=True)\n    municipio = models.CharField(max_length=100, verbose_name=\"Município\", blank=True)\n    provincia = models.CharField(max_length=100, verbose_name=\"Província\", blank=True)\n    tipo = models.CharField(\n        max_length=20,\n        choices=[\n            ('Pública', 'Pública'),\n            ('Privada', 'Privada'),\n        ],\n        default='Pública',\n        verbose_name=\"Tipo\"\n    )\n    data_cadastro = models.DateTimeField(auto_now_add=True)\n    \n    class Meta:\n        verbose_name = \"Escola\"\n        verbose_name_plural = \"Escolas\"\n        ordering = ['nome']\n    \n    def __str__(self):\n        return self.nome\n\nclass Inscricao(models.Model):\n    TURNO_CHOICES = [\n        ('M', 'Manhã'),\n        ('T', 'Tarde'),\n        ('N', 'Noite'),\n    ]\n    \n    ESTADO_CIVIL_CHOICES = [\n        ('S', 'Solteiro(a)'),\n        ('C', 'Casado(a)'),\n        ('D', 'Divorciado(a)'),\n        ('V', 'Viúvo(a)'),\n    ]\n    \n    numero_inscricao = models.CharField(max_length=20, unique=True, blank=True, verbose_name=\"Número de Inscrição\")\n    curso = models.ForeignKey(Curso, on_delete=models.CASCADE, related_name='inscricoes', verbose_name=\"Curso\")\n    \n    # 1. Informações Pessoais\n    nome_completo = models.CharField(max_length=200, verbose_name=\"Nome Completo\")\n    data_nascimento = models.DateField(verbose_name=\"Data de Nascimento\")\n    local_nascimento = models.CharField(max_length=200, verbose_name=\"Local de Nascimento\", default=\"Luanda\")\n    nacionalidade = models.CharField(max_length=100, verbose_name=\"Nacionalidade\", default=\"Angolana\")\n    bilhete_identidade = models.CharField(max_length=50, verbose_name=\"Número do Bilhete de Identidade\")\n    data_validade_bi = models.DateField(verbose_name=\"Data de Validade do BI\", null=True, blank=True)\n    sexo = models.CharField(max_length=1, choices=[('M', 'Masculino'), ('F', 'Feminino')], verbose_name=\"Sexo\")\n    estado_civil = models.CharField(max_length=1, choices=ESTADO_CIVIL_CHOICES, default='S', verbose_name=\"Estado Civil\")\n    endereco = models.TextField(verbose_name=\"Endereço Completo\")\n    telefone = models.CharField(max_length=20, verbose_name=\"Telefone\")\n    email = models.EmailField(verbose_name=\"Email\")\n    \n    # 2. Informações Académicas\n    escola = models.ForeignKey(Escola, on_delete=models.SET_NULL, null=True, blank=True, related_name='inscricoes', verbose_name=\"Última Escola Frequentada\")\n    ano_conclusao = models.CharField(max_length=4, verbose_name=\"Ano de Conclusão\", default=\"2024\")\n    certificados_obtidos = models.TextField(verbose_name=\"Certificados/Diplomas Obtidos\", blank=True, default=\"\")\n    historico_escolar = models.TextField(verbose_name=\"Notas/Histórico Escolar\", blank=True, default=\"\")\n    turno_preferencial = models.CharField(max_length=1, choices=TURNO_CHOICES, verbose_name=\"Turno Preferencial\", default='M')\n    \n    # 3. Informações Financeiras\n    numero_comprovante = models.CharField(max_length=100, verbose_name=\"Número do Comprovante/Boleto\", blank=True)\n    responsavel_financeiro_nome = models.CharField(max_length=200, verbose_name=\"Nome do Responsável Financeiro\", blank=True)\n    responsavel_financeiro_telefone = models.CharField(max_length=20, verbose_name=\"Telefone do Responsável Financeiro\", blank=True)\n    responsavel_financeiro_relacao = models.CharField(max_length=100, verbose_name=\"Relação com o Estudante\", blank=True)\n    \n    # 4. Encarregado de Educação\n    encarregado_nome = models.CharField(max_length=200, verbose_name=\"Nome do Encarregado de Educação\", blank=True)\n    encarregado_parentesco = models.CharField(max_length=100, verbose_name=\"Grau de Parentesco\", blank=True)\n    encarregado_telefone = models.CharField(max_length=20, verbose_name=\"Telefone do Encarregado\", blank=True)\n    encarregado_email = models.EmailField(verbose_name=\"Email do Encarregado\", blank=True)\n    encarregado_profissao = models.CharField(max_length=200, verbose_name=\"Profissão do Encarregado\", blank=True)\n    encarregado_local_trabalho = models.CharField(max_length=200, verbose_name=\"Local de Trabalho do Encarregado\", blank=True)\n    \n    # Sistema de Aprovação\n    nota_teste = models.DecimalField(\n        max_digits=4, \n        decimal_places=2,\n        null=True, \n        blank=True,\n        validators=[MinValueValidator(0.00), MaxValueValidator(20.00)],\n        verbose_name=\"Nota do Teste (0-20)\"\n    )\n    \n    aprovado = models.BooleanField(default=False, verbose_name=\"Aprovado\")\n    data_inscricao = models.DateTimeField(auto_now_add=True, verbose_name=\"Data de Inscrição\")\n    data_resultado = models.DateTimeField(null=True, blank=True, verbose_name=\"Data do Resultado\")\n    \n    class Meta:\n        verbose_name = \"Inscrição\"\n        verbose_name_plural = \"Inscrições\"\n        ordering = ['-data_inscricao']\n    \n    def __str__(self):\n        return f\"{self.numero_inscricao} - {self.nome_completo}\"\n    \n    def save(self, *args, **kwargs):\n        if not self.numero_inscricao:\n            ultimo = Inscricao.objects.order_by('-id').first()\n            if ultimo:\n                numero = int(ultimo.numero_inscricao.split('-')[1]) + 1\n            else:\n                numero = 1\n            self.numero_inscricao = f\"INS-{numero:06d}\"\n        super().save(*args, **kwargs)\n    \n    def calcular_idade(self):\n        \"\"\"Calcula a idade do estudante\"\"\"\n        from datetime import date\n        hoje = date.today()\n        idade = hoje.year - self.data_nascimento.year\n        if (hoje.month, hoje.day) < (self.data_nascimento.month, self.data_nascimento.day):\n            idade -= 1\n        return idade\n    \n    def proximo_aniversario(self):\n        \"\"\"Retorna a data do próximo aniversário\"\"\"\n        from datetime import date\n        hoje = date.today()\n        proximo = date(hoje.year, self.data_nascimento.month, self.data_nascimento.day)\n        if proximo < hoje:\n            proximo = date(hoje.year + 1, self.data_nascimento.month, self.data_nascimento.day)\n        return proximo\n    \n    def bi_vencido(self):\n        \"\"\"Verifica se o BI está vencido\"\"\"\n        from datetime import date\n        if self.data_validade_bi:\n            return self.data_validade_bi < date.today()\n        return False\n\nclass Professor(models.Model):\n    user = models.OneToOneField(User, on_delete=models.CASCADE, null=True, blank=True)\n    nome_completo = models.CharField(max_length=200, verbose_name=\"Nome Completo\")\n    bilhete_identidade = models.CharField(max_length=50, verbose_name=\"Bilhete de Identidade\")\n    data_nascimento = models.DateField(verbose_name=\"Data de Nascimento\")\n    sexo = models.CharField(max_length=1, choices=[('M', 'Masculino'), ('F', 'Feminino')], verbose_name=\"Sexo\")\n    telefone = models.CharField(max_length=20, verbose_name=\"Telefone\")\n    email = models.EmailField(verbose_name=\"Email\")\n    endereco = models.TextField(verbose_name=\"Endereço\")\n    especialidade = models.CharField(max_length=200, verbose_name=\"Especialidade\")\n    data_contratacao = models.DateField(verbose_name=\"Data de Contratação\", default=timezone.now)\n    \n    class Meta:\n        verbose_name = \"Professor\"\n        verbose_name_plural = \"Professores\"\n        ordering = ['nome_completo']\n    \n    def __str__(self):\n        return self.nome_completo\n\nclass Turma(models.Model):\n    nome = models.CharField(max_length=100, verbose_name=\"Nome da Turma\")\n    curso = models.ForeignKey(Curso, on_delete=models.CASCADE, related_name='turmas', verbose_name=\"Curso\")\n    ano_letivo = models.CharField(max_length=9, verbose_name=\"Ano Letivo (ex: 2024/2025)\")\n    professor_titular = models.ForeignKey(Professor, on_delete=models.SET_NULL, null=True, blank=True, verbose_name=\"Professor Titular\")\n    \n    class Meta:\n        verbose_name = \"Turma\"\n        verbose_name_plural = \"Turmas\"\n        ordering = ['ano_letivo', 'nome']\n    \n    def __str__(self):\n        return f\"{self.nome} - {self.curso.nome} ({self.ano_letivo})\"\n\nclass Aluno(models.Model):\n    user = models.OneToOneField(User, on_delete=models.CASCADE, null=True, blank=True)\n    nome_completo = models.CharField(max_length=200, verbose_name=\"Nome Completo\")\n    numero_estudante = models.CharField(max_length=20, unique=True, verbose_name=\"Número de Estudante\")\n    bilhete_identidade = models.CharField(max_length=50, verbose_name=\"Bilhete de Identidade\")\n    data_nascimento = models.DateField(verbose_name=\"Data de Nascimento\")\n    sexo = models.CharField(max_length=1, choices=[('M', 'Masculino'), ('F', 'Feminino')], verbose_name=\"Sexo\")\n    telefone = models.CharField(max_length=20, verbose_name=\"Telefone\")\n    email = models.EmailField(verbose_name=\"Email\")\n    endereco = models.TextField(verbose_name=\"Endereço\")\n    turma = models.ForeignKey(Turma, on_delete=models.SET_NULL, null=True, blank=True, related_name='alunos', verbose_name=\"Turma\")\n    data_matricula = models.DateField(verbose_name=\"Data de Matrícula\", default=timezone.now)\n    \n    class Meta:\n        verbose_name = \"Aluno\"\n        verbose_name_plural = \"Alunos\"\n        ordering = ['nome_completo']\n    \n    def __str__(self):\n        return f\"{self.numero_estudante} - {self.nome_completo}\"\n    \n    def save(self, *args, **kwargs):\n        if not self.numero_estudante:\n            ultimo = Aluno.objects.order_by('-id').first()\n            if ultimo and ultimo.numero_estudante:\n                numero = int(ultimo.numero_estudante.split('-')[1]) + 1\n            else:\n                numero = 1\n            self.numero_estudante = f\"ALU-{numero:06d}\"\n        super().save(*args, **kwargs)\n\nclass Pai(models.Model):\n    nome_completo = models.CharField(max_length=200, verbose_name=\"Nome Completo\")\n    bilhete_identidade = models.CharField(max_length=50, verbose_name=\"Bilhete de Identidade\")\n    telefone = models.CharField(max_length=20, verbose_name=\"Telefone\")\n    email = models.EmailField(blank=True, verbose_name=\"Email\")\n    endereco = models.TextField(verbose_name=\"Endereço\")\n    parentesco = models.CharField(max_length=50, verbose_name=\"Parentesco (Pai, Mãe, Tutor, etc.)\")\n    alunos = models.ManyToManyField(Aluno, related_name='pais', verbose_name=\"Alunos\")\n    \n    class Meta:\n        verbose_name = \"Pai/Responsável\"\n        verbose_name_plural = \"Pais/Responsáveis\"\n        ordering = ['nome_completo']\n    \n    def __str__(self):\n        return f\"{self.nome_completo} ({self.parentesco})\"\n\nclass PerfilUsuario(models.Model):\n    NIVEL_ACESSO_CHOICES = [\n        ('pendente', 'Pendente de Aprovação'),\n        ('admin', 'Administrador'),\n        ('secretaria', 'Secretaria'),\n        ('professor', 'Professor'),\n        ('coordenador', 'Coordenador'),\n        ('aluno', 'Aluno'),\n    ]\n    \n    user = models.OneToOneField(User, on_delete=models.CASCADE, related_name='perfil', verbose_name=\"Usuário\")\n    nivel_acesso = models.CharField(\n        max_length=20,\n        choices=NIVEL_ACESSO_CHOICES,\n        default='pendente',\n        verbose_name=\"Nível de Acesso\"\n    )\n    telefone = models.CharField(max_length=20, blank=True, verbose_name=\"Telefone\")\n    foto = models.ImageField(upload_to='usuarios/', blank=True, null=True, verbose_name=\"Foto\")\n    data_cadastro = models.DateTimeField(auto_now_add=True, verbose_name=\"Data de Cadastro\")\n    ativo = models.BooleanField(default=True, verbose_name=\"Ativo\")\n    \n    class Meta:\n        verbose_name = \"Perfil de Usuário\"\n        verbose_name_plural = \"Perfis de Usuários\"\n        ordering = ['user__username']\n    \n    def __str__(self):\n        return f\"{self.user.get_full_name() or self.user.username} - {self.get_nivel_acesso_display()}\"\n\nclass Notificacao(models.Model):\n    TIPO_CHOICES = [\n        ('info', 'Informação'),\n        ('aviso', 'Aviso'),\n        ('urgente', 'Urgente'),\n        ('sucesso', 'Sucesso'),\n    ]\n    \n    titulo = models.CharField(max_length=200, verbose_name=\"Título\")\n    mensagem = models.TextField(verbose_name=\"Mensagem\")\n    tipo = models.CharField(\n        max_length=20,\n        choices=TIPO_CHOICES,\n        default='info',\n        verbose_name=\"Tipo\"\n    )\n    data_criacao = models.DateTimeField(auto_now_add=True, verbose_name=\"Data de Criação\")\n    destinatarios = models.ManyToManyField(\n        User,\n        related_name='notificacoes',\n        verbose_name=\"Destinatários\",\n        blank=True\n    )\n    lida_por = models.ManyToManyField(\n        User,\n        related_name='notificacoes_lidas',\n        verbose_name=\"Lida por\",\n        blank=True\n    )\n    global_notificacao = models.BooleanField(\n        default=False,\n        verbose_name=\"Notificação Global\",\n        help_text=\"Se marcado, todos os usuários verão esta notificação\"\n    )\n    ativa = models.BooleanField(default=True, verbose_name=\"Ativa\")\n    \n    class Meta:\n        verbose_name = \"Notificação\"\n        verbose_name_plural = \"Notificações\"\n        ordering = ['-data_criacao']\n    \n    def __str__(self):\n        return f\"{self.titulo} - {self.get_tipo_display()}\"\n    \n    def marcar_como_lida(self, usuario):\n        self.lida_por.add(usuario)\n    \n    def esta_lida(self, usuario):\n        return self.lida_por.filter(id=usuario.id).exists()\n\nclass Subscricao(models.Model):\n    PLANO_CHOICES = [\n        ('mensal', 'Mensal'),\n        ('trimestral', 'Trimestral'),\n        ('semestral', 'Semestral'),\n        ('anual', 'Anual'),\n    ]\n    \n    ESTADO_CHOICES = [\n        ('ativo', 'Ativo'),\n        ('expirado', 'Expirado'),\n        ('cancelado', 'Cancelado'),\n        ('teste', 'Período de Teste'),\n    ]\n    \n    nome_escola = models.CharField(max_length=200, verbose_name=\"Nome da Escola\", unique=True)\n    plano = models.CharField(\n        max_length=20,\n        choices=PLANO_CHOICES,\n        default='mensal',\n        verbose_name=\"Plano\"\n    )\n    data_inicio = models.DateField(verbose_name=\"Data de Início\")\n    data_expiracao = models.DateField(verbose_name=\"Data de Expiração\")\n    estado = models.CharField(\n        max_length=20,\n        choices=ESTADO_CHOICES,\n        default='teste',\n        verbose_name=\"Estado\"\n    )\n    valor_pago = models.DecimalField(\n        max_digits=10,\n        decimal_places=2,\n        default=0.00,\n        verbose_name=\"Valor Pago\"\n    )\n    observacoes = models.TextField(blank=True, verbose_name=\"Observações\")\n    data_criacao = models.DateTimeField(auto_now_add=True)\n    \n    class Meta:\n        verbose_name = \"Subscrição\"\n        verbose_name_plural = \"Subscrições\"\n        ordering = ['-data_inicio']\n    \n    def __str__(self):\n        return f\"{self.nome_escola} - {self.get_plano_display()}\"\n    \n    def dias_restantes(self):\n        \"\"\"Calcula quantos dias faltam para expirar\"\"\"\n        from datetime import date\n        if self.data_expiracao:\n            delta = self.data_expiracao - date.today()\n            return max(0, delta.days)\n        return 0\n    \n    def esta_ativo(self):\n        \"\"\"Verifica se a subscrição está ativa\"\"\"\n        from datetime import date\n        return self.estado in ['ativo', 'teste'] and self.data_expiracao >= date.today()\n    \n    def percentual_usado(self):\n        \"\"\"Retorna o percentual de tempo usado da subscrição\"\"\"\n        from datetime import date\n        if self.data_inicio and self.data_expiracao:\n            total_dias = (self.data_expiracao - self.data_inicio).days\n            dias_passados = (date.today() - self.data_inicio).days\n            if total_dias > 0:\n                return min(100, int((dias_passados / total_dias) * 100))\n        return 0\n\nclass PagamentoSubscricao(models.Model):\n    \"\"\"Modelo para registrar pagamentos de renovação de subscrição\"\"\"\n    STATUS_CHOICES = [\n        ('pendente', 'Pendente'),\n        ('aprovado', 'Aprovado'),\n        ('rejeitado', 'Rejeitado'),\n    ]\n    \n    subscricao = models.ForeignKey(\n        Subscricao,\n        on_delete=models.CASCADE,\n        related_name='pagamentos',\n        verbose_name=\"Subscrição\"\n    )\n    plano_escolhido = models.CharField(\n        max_length=20,\n        choices=Subscricao.PLANO_CHOICES,\n        default='mensal',\n        verbose_name=\"Plano Escolhido\"\n    )\n    valor = models.DecimalField(\n        max_digits=10,\n        decimal_places=2,\n        verbose_name=\"Valor Pago\"\n    )\n    comprovante = models.FileField(\n        upload_to='comprovantes/',\n        verbose_name=\"Comprovante de Pagamento\"\n    )\n    numero_referencia = models.CharField(\n        max_length=100,\n        blank=True,\n        verbose_name=\"Número de Referência\"\n    )\n    status = models.CharField(\n        max_length=20,\n        choices=STATUS_CHOICES,\n        default='pendente',\n        verbose_name=\"Status\"\n    )\n    data_pagamento = models.DateField(verbose_name=\"Data do Pagamento\")\n    data_submissao = models.DateTimeField(auto_now_add=True, verbose_name=\"Data de Submissão\")\n    observacoes = models.TextField(blank=True, verbose_name=\"Observações\")\n    \n    aprovado_por = models.ForeignKey(\n        'auth.User',\n        on_delete=models.SET_NULL,\n        null=True,\n        blank=True,\n        related_name='pagamentos_aprovados',\n        verbose_name=\"Aprovado Por\"\n    )\n    data_aprovacao = models.DateTimeField(null=True, blank=True, verbose_name=\"Data de Aprovação\")\n    recibo_pdf = models.FileField(\n        upload_to='recibos/',\n        null=True,\n        blank=True,\n        verbose_name=\"Recibo PDF\"\n    )\n    \n    class Meta:\n        verbose_name = \"Pagamento de Subscrição\"\n        verbose_name_plural = \"Pagamentos de Subscrição\"\n        ordering = ['-data_submissao']\n    \n    def __str__(self):\n        return f\"Pagamento {self.id} - {self.subscricao.nome_escola} - {self.get_status_display()}\"\n\nclass RecuperacaoSenha(models.Model):\n    \"\"\"Modelo para gerenciar recuperação de senha via email ou telefone\"\"\"\n    TIPO_CHOICES = [\n        ('email', 'Email'),\n        ('telefone', 'Telefone'),\n    ]\n    \n    user = models.ForeignKey(\n        'auth.User',\n        on_delete=models.CASCADE,\n        related_name='recuperacoes_senha',\n        verbose_name=\"Usuário\"\n    )\n    tipo = models.CharField(\n        max_length=20,\n        choices=TIPO_CHOICES,\n        verbose_name=\"Tipo de Recuperação\"\n    )\n    codigo_otp = models.CharField(\n        max_length=6,\n        blank=True,\n        verbose_name=\"Código OTP\"\n    )\n    token = models.CharField(\n        max_length=100,\n        blank=True,\n        verbose_name=\"Token de Recuperação\"\n    )\n    email_enviado = models.EmailField(blank=True, verbose_name=\"Email Enviado Para\")\n    telefone_enviado = models.CharField(max_length=20, blank=True, verbose_name=\"Telefone Enviado Para\")\n    usado = models.BooleanField(default=False, verbose_name=\"Usado\")\n    data_criacao = models.DateTimeField(auto_now_add=True, verbose_name=\"Data de Criação\")\n    data_expiracao = models.DateTimeField(verbose_name=\"Data de Expiração\")\n    \n    class Meta:\n        verbose_name = \"Recuperação de Senha\"\n        verbose_name_plural = \"Recuperações de Senha\"\n        ordering = ['-data_criacao']\n    \n    def __str__(self):\n        return f\"{self.user.username} - {self.get_tipo_display()} - {'Usado' if self.usado else 'Pendente'}\"\n    \n    def esta_expirado(self):\n        from django.utils import timezone\n        return timezone.now() > self.data_expiracao\n    \n    def marcar_como_usado(self):\n        self.usado = True\n        self.save()\n","size_bytes":23245},"core/tests.py":{"content":"from django.test import TestCase\n\n# Create your tests here.\n","size_bytes":60},"core/views.py":{"content":"from django.shortcuts import render, redirect, get_object_or_404\nfrom django.contrib import messages\nfrom django.http import HttpResponse, JsonResponse\nfrom django.utils import timezone\nfrom .models import Curso, Inscricao, ConfiguracaoEscola, Escola, AnoAcademico, Notificacao, PerfilUsuario, Subscricao, PagamentoSubscricao, RecuperacaoSenha\nfrom django.views.decorators.http import require_http_methods\nfrom django.contrib.auth import authenticate, login as auth_login, logout as auth_logout\nfrom django.contrib.auth.decorators import login_required\nfrom django.contrib.auth.models import User\nfrom django.db.models import Q\nfrom django.db import IntegrityError\nimport json\nfrom reportlab.lib.pagesizes import A4\nfrom reportlab.lib.styles import getSampleStyleSheet, ParagraphStyle\nfrom reportlab.lib.units import cm\nfrom reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Image\nfrom reportlab.lib.enums import TA_CENTER, TA_LEFT\nfrom io import BytesIO\nfrom datetime import datetime\nfrom django.conf import settings\nimport os\n\ndef processar_aprovacoes_curso(curso_id):\n    curso = Curso.objects.get(id=curso_id)\n    inscricoes_com_nota = curso.inscricoes.filter(nota_teste__isnull=False, nota_teste__gte=curso.nota_minima).order_by('-nota_teste')\n    \n    for inscricao in curso.inscricoes.all():\n        inscricao.aprovado = False\n        inscricao.save()\n    \n    vagas_disponiveis = curso.vagas\n    for i, inscricao in enumerate(inscricoes_com_nota):\n        if i < vagas_disponiveis:\n            inscricao.aprovado = True\n            inscricao.data_resultado = timezone.now()\n            inscricao.save()\n\n@login_required\ndef index(request):\n    cursos = Curso.objects.filter(ativo=True)\n    config = ConfiguracaoEscola.objects.first()\n    anos_academicos = AnoAcademico.objects.all()\n    ano_atual = AnoAcademico.objects.filter(ativo=True).first()\n    \n    # Se não houver ano ativo, pegar o mais recente\n    if not ano_atual and anos_academicos.exists():\n        ano_atual = anos_academicos.first()\n    \n    return render(request, 'core/index.html', {\n        'cursos': cursos,\n        'config': config,\n        'anos_academicos': anos_academicos,\n        'ano_atual': ano_atual\n    })\n\ndef inscricao_create(request, curso_id):\n    curso = get_object_or_404(Curso, id=curso_id, ativo=True)\n    \n    if request.method == 'POST':\n        # Validar BI único\n        bilhete_identidade = request.POST.get('bilhete_identidade')\n        if bilhete_identidade and Inscricao.objects.filter(bilhete_identidade=bilhete_identidade).exists():\n            messages.error(request, 'Este Bilhete de Identidade já está registrado no sistema!')\n            return render(request, 'core/inscricao_form.html', {'curso': curso})\n        \n        # Validar email único em inscrições\n        email = request.POST.get('email')\n        if email and Inscricao.objects.filter(email=email).exists():\n            messages.error(request, 'Este email já está sendo usado em outra inscrição!')\n            return render(request, 'core/inscricao_form.html', {'curso': curso})\n        \n        # Validar telefone único em inscrições\n        telefone = request.POST.get('telefone')\n        if telefone and Inscricao.objects.filter(telefone=telefone).exists():\n            messages.error(request, 'Este telefone já está sendo usado em outra inscrição!')\n            return render(request, 'core/inscricao_form.html', {'curso': curso})\n        \n        # Obter escola\n        escola_id = request.POST.get('escola_id')\n        escola = None\n        if escola_id:\n            try:\n                escola = Escola.objects.get(id=escola_id)\n            except Escola.DoesNotExist:\n                pass\n        \n        inscricao = Inscricao(\n            curso=curso,\n            # 1. Informações Pessoais\n            nome_completo=request.POST['nome_completo'],\n            data_nascimento=request.POST['data_nascimento'],\n            local_nascimento=request.POST['local_nascimento'],\n            nacionalidade=request.POST['nacionalidade'],\n            bilhete_identidade=request.POST['bilhete_identidade'],\n            data_validade_bi=request.POST.get('data_validade_bi') or None,\n            sexo=request.POST['sexo'],\n            estado_civil=request.POST.get('estado_civil', 'S'),\n            endereco=request.POST['endereco'],\n            telefone=request.POST['telefone'],\n            email=request.POST['email'],\n            # 2. Informações Académicas\n            escola=escola,\n            ano_conclusao=request.POST['ano_conclusao'],\n            certificados_obtidos=request.POST.get('certificados_obtidos', ''),\n            historico_escolar=request.POST.get('historico_escolar', ''),\n            turno_preferencial=request.POST.get('turno_preferencial', 'M'),\n            # 3. Informações Financeiras\n            numero_comprovante=request.POST.get('numero_comprovante', ''),\n            responsavel_financeiro_nome=request.POST.get('responsavel_financeiro_nome', ''),\n            responsavel_financeiro_telefone=request.POST.get('responsavel_financeiro_telefone', ''),\n            responsavel_financeiro_relacao=request.POST.get('responsavel_financeiro_relacao', ''),\n            # 4. Encarregado de Educação\n            encarregado_nome=request.POST.get('encarregado_nome', ''),\n            encarregado_parentesco=request.POST.get('encarregado_parentesco', ''),\n            encarregado_telefone=request.POST.get('encarregado_telefone', ''),\n            encarregado_email=request.POST.get('encarregado_email', ''),\n            encarregado_profissao=request.POST.get('encarregado_profissao', ''),\n            encarregado_local_trabalho=request.POST.get('encarregado_local_trabalho', ''),\n        )\n        \n        inscricao.save()\n        messages.success(request, f'Inscrição realizada com sucesso! Seu número de inscrição é: {inscricao.numero_inscricao}')\n        return redirect('inscricao_consulta', numero=inscricao.numero_inscricao)\n    \n    return render(request, 'core/inscricao_form.html', {'curso': curso})\n\ndef inscricao_consulta(request, numero):\n    inscricao = get_object_or_404(Inscricao, numero_inscricao=numero)\n    return render(request, 'core/inscricao_consulta.html', {'inscricao': inscricao})\n\ndef inscricao_buscar(request):\n    if request.method == 'POST':\n        numero = request.POST.get('numero_inscricao', '').strip()\n        if numero:\n            try:\n                inscricao = Inscricao.objects.get(numero_inscricao=numero)\n                return redirect('inscricao_consulta', numero=numero)\n            except Inscricao.DoesNotExist:\n                messages.error(request, 'Número de inscrição não encontrado!')\n    \n    return render(request, 'core/inscricao_buscar.html')\n\ndef gerar_pdf_confirmacao(request, numero):\n    inscricao = get_object_or_404(Inscricao, numero_inscricao=numero)\n    config = ConfiguracaoEscola.objects.first()\n    \n    buffer = BytesIO()\n    doc = SimpleDocTemplate(buffer, pagesize=A4, topMargin=2*cm, bottomMargin=2*cm)\n    story = []\n    styles = getSampleStyleSheet()\n    \n    title_style = ParagraphStyle(\n        'CustomTitle',\n        parent=styles['Heading1'],\n        fontSize=18,\n        textColor='#1a1a1a',\n        spaceAfter=30,\n        alignment=TA_CENTER\n    )\n    \n    heading_style = ParagraphStyle(\n        'CustomHeading',\n        parent=styles['Heading2'],\n        fontSize=14,\n        textColor='#333333',\n        spaceAfter=12,\n        alignment=TA_LEFT\n    )\n    \n    normal_style = ParagraphStyle(\n        'CustomNormal',\n        parent=styles['Normal'],\n        fontSize=11,\n        textColor='#000000',\n        spaceAfter=8,\n        alignment=TA_LEFT\n    )\n    \n    logo_path = os.path.join(settings.BASE_DIR, 'core', 'static', 'core', 'images', 'siga-logo.png')\n    if os.path.exists(logo_path):\n        try:\n            img = Image(logo_path, width=4*cm, height=1.5*cm)\n            img.hAlign = 'CENTER'\n            story.append(img)\n            story.append(Spacer(1, 0.5*cm))\n        except:\n            pass\n    \n    escola_nome = config.nome_escola if config else \"Sistema Escolar\"\n    story.append(Paragraph(escola_nome, title_style))\n    story.append(Paragraph(\"CONFIRMAÇÃO DE INSCRIÇÃO\", heading_style))\n    story.append(Spacer(1, 0.5*cm))\n    \n    if config and config.template_confirmacao_inscricao:\n        template = config.template_confirmacao_inscricao\n    else:\n        template = \"CONFIRMAÇÃO DE INSCRIÇÃO\\n\\nNome: {nome}\\nCurso: {curso}\\nNúmero de Inscrição: {numero}\\nData: {data}\"\n    \n    conteudo = template.format(\n        nome=inscricao.nome_completo,\n        curso=inscricao.curso.nome,\n        numero=inscricao.numero_inscricao,\n        data=inscricao.data_inscricao.strftime('%d/%m/%Y')\n    )\n    \n    for linha in conteudo.split('\\n'):\n        if linha.strip():\n            story.append(Paragraph(linha, normal_style))\n    \n    story.append(Spacer(1, 1*cm))\n    story.append(Paragraph(f\"Data de Nascimento: {inscricao.data_nascimento.strftime('%d/%m/%Y')}\", normal_style))\n    story.append(Paragraph(f\"Bilhete de Identidade: {inscricao.bilhete_identidade}\", normal_style))\n    story.append(Paragraph(f\"Telefone: {inscricao.telefone}\", normal_style))\n    story.append(Paragraph(f\"Email: {inscricao.email}\", normal_style))\n    \n    if inscricao.nota_teste is not None:\n        story.append(Spacer(1, 0.5*cm))\n        story.append(Paragraph(f\"Nota do Teste: {inscricao.nota_teste}\", normal_style))\n        status = \"APROVADO\" if inscricao.aprovado else \"NÃO APROVADO\"\n        story.append(Paragraph(f\"Status: {status}\", normal_style))\n    \n    doc.build(story)\n    \n    buffer.seek(0)\n    response = HttpResponse(buffer.getvalue(), content_type='application/pdf')\n    response['Content-Disposition'] = f'attachment; filename=\"confirmacao_{inscricao.numero_inscricao}.pdf\"'\n    \n    return response\n\n@login_required\ndef admissao_estudantes(request):\n    cursos = Curso.objects.filter(ativo=True)\n    config = ConfiguracaoEscola.objects.first()\n    return render(request, 'core/admissao.html', {\n        'cursos': cursos,\n        'config': config\n    })\n\n@login_required\ndef admissao_inscricao(request):\n    cursos = Curso.objects.filter(ativo=True)\n    config = ConfiguracaoEscola.objects.first()\n    \n    if request.method == 'POST':\n        curso_id = request.POST.get('curso_id')\n        if curso_id:\n            return redirect('inscricao_create', curso_id=curso_id)\n    \n    return render(request, 'core/admissao_inscricao.html', {\n        'cursos': cursos,\n        'config': config\n    })\n\n@login_required\ndef cursos_lista(request):\n    cursos = Curso.objects.all().order_by('-ativo', 'nome')\n    return render(request, 'core/cursos_lista.html', {'cursos': cursos})\n\n@login_required\ndef curso_create(request):\n    if request.method == 'POST':\n        curso = Curso(\n            nome=request.POST['nome'],\n            descricao=request.POST['descricao'],\n            vagas=request.POST['vagas'],\n            nota_minima=request.POST['nota_minima'],\n            ativo='ativo' in request.POST\n        )\n        curso.save()\n        messages.success(request, f'Curso \"{curso.nome}\" cadastrado com sucesso!')\n        return redirect('cursos_lista')\n    \n    return render(request, 'core/curso_form.html')\n\n@login_required\ndef curso_edit(request, curso_id):\n    curso = get_object_or_404(Curso, id=curso_id)\n    \n    if request.method == 'POST':\n        curso.nome = request.POST['nome']\n        curso.descricao = request.POST['descricao']\n        curso.vagas = request.POST['vagas']\n        curso.nota_minima = request.POST['nota_minima']\n        curso.ativo = 'ativo' in request.POST\n        curso.save()\n        messages.success(request, f'Curso \"{curso.nome}\" atualizado com sucesso!')\n        return redirect('cursos_lista')\n    \n    return render(request, 'core/curso_form.html', {'curso': curso})\n\n@login_required\ndef curso_toggle(request, curso_id):\n    curso = get_object_or_404(Curso, id=curso_id)\n    curso.ativo = not curso.ativo\n    curso.save()\n    \n    status = \"ativado\" if curso.ativo else \"desativado\"\n    messages.success(request, f'Curso \"{curso.nome}\" {status} com sucesso!')\n    return redirect('cursos_lista')\n\n@login_required\ndef dashboard(request):\n    cursos = Curso.objects.all()\n    total_inscricoes = Inscricao.objects.count()\n    total_aprovados = Inscricao.objects.filter(aprovado=True).count()\n    total_reprovados = Inscricao.objects.filter(aprovado=False, nota_teste__isnull=False).count()\n    aguardando_nota = Inscricao.objects.filter(nota_teste__isnull=True).count()\n    \n    return render(request, 'core/dashboard.html', {\n        'cursos': cursos,\n        'total_inscricoes': total_inscricoes,\n        'total_aprovados': total_aprovados,\n        'total_reprovados': total_reprovados,\n        'aguardando_nota': aguardando_nota\n    })\n\n@require_http_methods([\"GET\"])\ndef escolas_autocomplete(request):\n    \"\"\"Retorna escolas para autocomplete\"\"\"\n    query = request.GET.get('q', '')\n    escolas = Escola.objects.filter(nome__icontains=query)[:10]\n    \n    resultados = [\n        {\n            'id': escola.id,\n            'nome': escola.nome,\n            'municipio': escola.municipio,\n            'provincia': escola.provincia\n        }\n        for escola in escolas\n    ]\n    \n    return JsonResponse({'escolas': resultados})\n\n@require_http_methods([\"POST\"])\ndef escola_create_ajax(request):\n    \"\"\"Cria uma escola via AJAX\"\"\"\n    try:\n        data = json.loads(request.body)\n        nome = data.get('nome', '').strip()\n        municipio = data.get('municipio', '').strip()\n        provincia = data.get('provincia', '').strip()\n        tipo = data.get('tipo', 'Pública')\n        \n        if not nome:\n            return JsonResponse({'success': False, 'error': 'Nome da escola é obrigatório'}, status=400)\n        \n        escola = Escola.objects.create(\n            nome=nome,\n            municipio=municipio,\n            provincia=provincia,\n            tipo=tipo\n        )\n        \n        return JsonResponse({\n            'success': True,\n            'escola': {\n                'id': escola.id,\n                'nome': escola.nome,\n                'municipio': escola.municipio,\n                'provincia': escola.provincia\n            }\n        })\n    \n    except Exception as e:\n        return JsonResponse({'success': False, 'error': str(e)}, status=400)\n\n@require_http_methods([\"POST\"])\ndef trocar_ano_academico(request):\n    \"\"\"Trocar ano acadêmico ativo\"\"\"\n    try:\n        ano_id = request.POST.get('ano_id')\n        if not ano_id:\n            return JsonResponse({'success': False, 'error': 'ID do ano não fornecido'}, status=400)\n        \n        ano = get_object_or_404(AnoAcademico, id=ano_id)\n        \n        # Desativar todos os anos\n        AnoAcademico.objects.all().update(ativo=False)\n        \n        # Ativar o ano selecionado\n        ano.ativo = True\n        ano.save()\n        \n        return JsonResponse({\n            'success': True,\n            'ano': str(ano)\n        })\n    \n    except Exception as e:\n        return JsonResponse({'success': False, 'error': str(e)}, status=400)\n\ndef login_view(request):\n    \"\"\"View de login personalizada\"\"\"\n    from .models import Subscricao\n    \n    if request.user.is_authenticated:\n        return redirect('dashboard')\n    \n    if request.method == 'POST':\n        username = request.POST.get('username')\n        password = request.POST.get('password')\n        user = authenticate(request, username=username, password=password)\n        \n        if user is not None:\n            if hasattr(user, 'perfil') and user.perfil.nivel_acesso == 'pendente':\n                messages.warning(request, 'Sua conta está aguardando aprovação do administrador. Você receberá acesso assim que seu perfil for atribuído.')\n                return render(request, 'core/login.html')\n            \n            subscricao = Subscricao.objects.filter(estado__in=['ativo', 'teste']).first()\n            \n            if subscricao and not subscricao.esta_ativo():\n                messages.error(request, 'Subscrição vencida! Por favor, renove a subscrição para continuar usando o sistema.')\n                return redirect('renovar_subscricao')\n            elif not subscricao:\n                messages.error(request, 'Nenhuma subscrição encontrada! Por favor, configure a subscrição para usar o sistema.')\n                return render(request, 'core/login.html')\n            \n            auth_login(request, user)\n            messages.success(request, f'Bem-vindo, {user.get_full_name() or user.username}!')\n            next_url = request.GET.get('next', 'dashboard')\n            return redirect(next_url)\n        else:\n            messages.error(request, 'Usuário ou senha inválidos!')\n    \n    return render(request, 'core/login.html')\n\ndef registro_view(request):\n    \"\"\"View de registro de usuário\"\"\"\n    if request.user.is_authenticated:\n        return redirect('dashboard')\n    \n    if request.method == 'POST':\n        username = request.POST.get('username')\n        first_name = request.POST.get('first_name')\n        last_name = request.POST.get('last_name')\n        email = request.POST.get('email')\n        telefone = request.POST.get('telefone')\n        password1 = request.POST.get('password1')\n        password2 = request.POST.get('password2')\n        \n        if password1 != password2:\n            messages.error(request, 'As senhas não coincidem!')\n            return render(request, 'core/registro.html')\n        \n        if User.objects.filter(username=username).exists():\n            messages.error(request, 'Nome de usuário já existe!')\n            return render(request, 'core/registro.html')\n        \n        if email and User.objects.filter(email=email).exists():\n            messages.error(request, 'Este email já está sendo usado por outro usuário!')\n            return render(request, 'core/registro.html')\n        \n        if telefone and PerfilUsuario.objects.filter(telefone=telefone).exists():\n            messages.error(request, 'Este telefone já está sendo usado por outro usuário!')\n            return render(request, 'core/registro.html')\n        \n        for user in User.objects.all():\n            if user.check_password(password1):\n                messages.error(request, 'Esta senha já está sendo usada por outro usuário. Por favor, escolha uma senha diferente.')\n                return render(request, 'core/registro.html')\n        \n        try:\n            user = User.objects.create_user(\n                username=username,\n                email=email,\n                password=password1,\n                first_name=first_name,\n                last_name=last_name\n            )\n            \n            if hasattr(user, 'perfil'):\n                user.perfil.telefone = telefone\n                user.perfil.save()\n                messages.success(request, 'Registro realizado com sucesso! Aguarde a aprovação do administrador para acessar o sistema.')\n                return redirect('login')\n            else:\n                messages.error(request, 'Erro: Perfil de usuário já existe. Entre em contato com o administrador.')\n                user.delete()\n                return render(request, 'core/registro.html')\n                \n        except IntegrityError:\n            messages.error(request, 'Erro: Perfil de usuário já existe para este usuário. Entre em contato com o administrador.')\n            return render(request, 'core/registro.html')\n        except Exception as e:\n            messages.error(request, f'Erro ao criar conta. Por favor, tente novamente.')\n            return render(request, 'core/registro.html')\n    \n    return render(request, 'core/registro.html')\n\ndef logout_view(request):\n    \"\"\"View de logout\"\"\"\n    auth_logout(request)\n    messages.success(request, 'Você saiu do sistema com sucesso!')\n    return redirect('login')\n\n@login_required\ndef notificacoes_view(request):\n    \"\"\"View para listar notificações do usuário\"\"\"\n    notificacoes = Notificacao.objects.filter(\n        Q(global_notificacao=True) | Q(destinatarios=request.user),\n        ativa=True\n    ).distinct().order_by('-data_criacao')\n    \n    nao_lidas = notificacoes.exclude(lida_por=request.user)\n    \n    context = {\n        'notificacoes': notificacoes,\n        'nao_lidas_count': nao_lidas.count()\n    }\n    return render(request, 'core/notificacoes.html', context)\n\n@login_required\n@require_http_methods([\"POST\"])\ndef marcar_notificacao_lida(request, notificacao_id):\n    \"\"\"Marcar notificação como lida\"\"\"\n    notificacao = get_object_or_404(Notificacao, id=notificacao_id)\n    notificacao.marcar_como_lida(request.user)\n    return JsonResponse({'success': True})\n\n@login_required\ndef get_notificacoes_count(request):\n    \"\"\"Retorna contagem de notificações não lidas\"\"\"\n    count = Notificacao.objects.filter(\n        Q(global_notificacao=True) | Q(destinatarios=request.user),\n        ativa=True\n    ).exclude(lida_por=request.user).distinct().count()\n    \n    return JsonResponse({'count': count})\n\ndef renovar_subscricao_view(request):\n    \"\"\"View pública para renovação de subscrição\"\"\"\n    from datetime import datetime\n    \n    subscricao = Subscricao.objects.filter(estado__in=['ativo', 'teste']).first()\n    \n    if not subscricao:\n        messages.error(request, 'Nenhuma subscrição encontrada no sistema!')\n        return redirect('login')\n    \n    if request.method == 'POST':\n        plano = request.POST.get('plano')\n        valor = request.POST.get('valor')\n        data_pagamento = request.POST.get('data_pagamento')\n        numero_referencia = request.POST.get('numero_referencia', '')\n        comprovante = request.FILES.get('comprovante')\n        observacoes = request.POST.get('observacoes', '')\n        \n        if not all([plano, valor, data_pagamento, comprovante]):\n            messages.error(request, 'Por favor, preencha todos os campos obrigatórios!')\n            return render(request, 'core/renovar_subscricao.html', {'subscricao': subscricao})\n        \n        pagamento = PagamentoSubscricao.objects.create(\n            subscricao=subscricao,\n            plano_escolhido=plano,\n            valor=valor,\n            data_pagamento=datetime.strptime(data_pagamento, '%Y-%m-%d').date(),\n            numero_referencia=numero_referencia,\n            comprovante=comprovante,\n            observacoes=observacoes,\n            status='pendente'\n        )\n        \n        messages.success(request, f'Pagamento registrado com sucesso! Número de referência: {pagamento.id:06d}. Aguarde a aprovação do administrador.')\n        return redirect('login')\n    \n    return render(request, 'core/renovar_subscricao.html', {'subscricao': subscricao})\n\ndef esqueci_senha_view(request):\n    \"\"\"View para escolher método de recuperação de senha\"\"\"\n    if request.method == 'POST':\n        identificador = request.POST.get('identificador')\n        metodo = request.POST.get('metodo')\n        \n        try:\n            user = User.objects.filter(Q(username=identificador) | Q(email=identificador)).first()\n            \n            if not user:\n                messages.error(request, 'Usuário não encontrado!')\n                return render(request, 'core/esqueci_senha.html')\n            \n            perfil = PerfilUsuario.objects.filter(user=user).first()\n            \n            if metodo == 'telefone':\n                if not perfil or not perfil.telefone:\n                    messages.error(request, 'Este usuário não possui telefone cadastrado!')\n                    return render(request, 'core/esqueci_senha.html')\n                \n                import random\n                from datetime import timedelta\n                from django.utils import timezone\n                \n                codigo_otp = str(random.randint(100000, 999999))\n                \n                recuperacao = RecuperacaoSenha.objects.create(\n                    user=user,\n                    tipo='telefone',\n                    codigo_otp=codigo_otp,\n                    telefone_enviado=perfil.telefone,\n                    data_expiracao=timezone.now() + timedelta(minutes=10)\n                )\n                \n                request.session['recuperacao_id'] = recuperacao.id\n                messages.info(request, f'Código OTP enviado para o telefone {perfil.telefone}')\n                return redirect('validar_otp')\n                \n            elif metodo == 'email':\n                if not user.email:\n                    messages.error(request, 'Este usuário não possui email cadastrado!')\n                    return render(request, 'core/esqueci_senha.html')\n                \n                import secrets\n                from datetime import timedelta\n                from django.utils import timezone\n                \n                token = secrets.token_urlsafe(32)\n                \n                recuperacao = RecuperacaoSenha.objects.create(\n                    user=user,\n                    tipo='email',\n                    token=token,\n                    email_enviado=user.email,\n                    data_expiracao=timezone.now() + timedelta(hours=1)\n                )\n                \n                messages.info(request, f'Link de recuperação enviado para {user.email}')\n                return redirect('login')\n        \n        except Exception as e:\n            messages.error(request, f'Erro ao processar recuperação: {str(e)}')\n    \n    return render(request, 'core/esqueci_senha.html')\n\ndef validar_otp_view(request):\n    \"\"\"View para validar código OTP e redefinir senha\"\"\"\n    recuperacao_id = request.session.get('recuperacao_id')\n    \n    if not recuperacao_id:\n        messages.error(request, 'Sessão expirada! Solicite nova recuperação.')\n        return redirect('esqueci_senha')\n    \n    try:\n        recuperacao = RecuperacaoSenha.objects.get(id=recuperacao_id, tipo='telefone', usado=False)\n        \n        if recuperacao.esta_expirado():\n            messages.error(request, 'Código OTP expirado! Solicite nova recuperação.')\n            return redirect('esqueci_senha')\n        \n        if request.method == 'POST':\n            codigo = request.POST.get('codigo_otp')\n            nova_senha = request.POST.get('nova_senha')\n            confirmar_senha = request.POST.get('confirmar_senha')\n            \n            if codigo != recuperacao.codigo_otp:\n                messages.error(request, 'Código OTP inválido!')\n                return render(request, 'core/validar_otp.html', {'recuperacao': recuperacao})\n            \n            if nova_senha != confirmar_senha:\n                messages.error(request, 'As senhas não coincidem!')\n                return render(request, 'core/validar_otp.html', {'recuperacao': recuperacao})\n            \n            if len(nova_senha) < 6:\n                messages.error(request, 'A senha deve ter no mínimo 6 caracteres!')\n                return render(request, 'core/validar_otp.html', {'recuperacao': recuperacao})\n            \n            for user_check in User.objects.exclude(id=recuperacao.user.id):\n                if user_check.check_password(nova_senha):\n                    messages.error(request, 'Esta senha já está sendo usada por outro usuário. Por favor, escolha uma senha diferente.')\n                    return render(request, 'core/validar_otp.html', {'recuperacao': recuperacao})\n            \n            user = recuperacao.user\n            user.set_password(nova_senha)\n            user.save()\n            \n            recuperacao.marcar_como_usado()\n            del request.session['recuperacao_id']\n            \n            messages.success(request, 'Senha redefinida com sucesso! Faça login com sua nova senha.')\n            return redirect('login')\n        \n        return render(request, 'core/validar_otp.html', {'recuperacao': recuperacao})\n    \n    except RecuperacaoSenha.DoesNotExist:\n        messages.error(request, 'Recuperação inválida!')\n        return redirect('esqueci_senha')\n\ndef redefinir_senha_email_view(request, token):\n    \"\"\"View para redefinir senha via link de email\"\"\"\n    try:\n        recuperacao = RecuperacaoSenha.objects.get(token=token, tipo='email', usado=False)\n        \n        if recuperacao.esta_expirado():\n            messages.error(request, 'Link expirado! Solicite nova recuperação.')\n            return redirect('esqueci_senha')\n        \n        if request.method == 'POST':\n            nova_senha = request.POST.get('nova_senha')\n            confirmar_senha = request.POST.get('confirmar_senha')\n            \n            if nova_senha != confirmar_senha:\n                messages.error(request, 'As senhas não coincidem!')\n                return render(request, 'core/redefinir_senha_email.html', {'token': token})\n            \n            if len(nova_senha) < 6:\n                messages.error(request, 'A senha deve ter no mínimo 6 caracteres!')\n                return render(request, 'core/redefinir_senha_email.html', {'token': token})\n            \n            for user_check in User.objects.exclude(id=recuperacao.user.id):\n                if user_check.check_password(nova_senha):\n                    messages.error(request, 'Esta senha já está sendo usada por outro usuário. Por favor, escolha uma senha diferente.')\n                    return render(request, 'core/redefinir_senha_email.html', {'token': token})\n            \n            user = recuperacao.user\n            user.set_password(nova_senha)\n            user.save()\n            \n            recuperacao.marcar_como_usado()\n            \n            messages.success(request, 'Senha redefinida com sucesso! Faça login com sua nova senha.')\n            return redirect('login')\n        \n        return render(request, 'core/redefinir_senha_email.html', {'token': token})\n    \n    except RecuperacaoSenha.DoesNotExist:\n        messages.error(request, 'Link inválido ou já utilizado!')\n        return redirect('esqueci_senha')\n\n@login_required\ndef perfis_pendentes_view(request):\n    \"\"\"View para administradores gerenciarem perfis pendentes\"\"\"\n    if not request.user.is_staff:\n        messages.error(request, 'Acesso negado! Apenas administradores podem acessar esta área.')\n        return redirect('dashboard')\n    \n    perfis_pendentes = PerfilUsuario.objects.filter(nivel_acesso='pendente').order_by('-data_cadastro')\n    \n    return render(request, 'core/perfis_pendentes.html', {\n        'perfis_pendentes': perfis_pendentes\n    })\n\n@login_required\ndef atribuir_perfil_view(request, perfil_id):\n    \"\"\"View para atribuir perfil a um usuário\"\"\"\n    if not request.user.is_staff:\n        messages.error(request, 'Acesso negado!')\n        return redirect('dashboard')\n    \n    perfil = get_object_or_404(PerfilUsuario, id=perfil_id)\n    \n    if request.method == 'POST':\n        nivel_acesso = request.POST.get('nivel_acesso')\n        \n        if nivel_acesso in ['admin', 'secretaria', 'professor', 'coordenador', 'aluno']:\n            perfil.nivel_acesso = nivel_acesso\n            perfil.save()\n            \n            Notificacao.objects.create(\n                titulo='Perfil Atribuído',\n                mensagem=f'Seu perfil foi atribuído como {perfil.get_nivel_acesso_display()}. Agora você pode acessar o sistema.',\n                tipo='sucesso'\n            ).destinatarios.add(perfil.user)\n            \n            messages.success(request, f'Perfil \"{perfil.get_nivel_acesso_display()}\" atribuído com sucesso para {perfil.user.get_full_name() or perfil.user.username}!')\n        else:\n            messages.error(request, 'Nível de acesso inválido!')\n        \n        return redirect('perfis_pendentes')\n    \n    return redirect('perfis_pendentes')\n\n@login_required\ndef get_perfis_pendentes_count(request):\n    \"\"\"API endpoint para obter contagem de perfis pendentes\"\"\"\n    if request.user.is_staff:\n        count = PerfilUsuario.objects.filter(nivel_acesso='pendente').count()\n        return JsonResponse({'count': count})\n    return JsonResponse({'count': 0})\n","size_bytes":32001},"escola_sistema/__init__.py":{"content":"","size_bytes":0},"escola_sistema/asgi.py":{"content":"\"\"\"\nASGI config for escola_sistema project.\n\nIt exposes the ASGI callable as a module-level variable named ``application``.\n\nFor more information on this file, see\nhttps://docs.djangoproject.com/en/5.2/howto/deployment/asgi/\n\"\"\"\n\nimport os\n\nfrom django.core.asgi import get_asgi_application\n\nos.environ.setdefault('DJANGO_SETTINGS_MODULE', 'escola_sistema.settings')\n\napplication = get_asgi_application()\n","size_bytes":405},"escola_sistema/settings.py":{"content":"\"\"\"\nDjango settings for escola_sistema project.\n\nGenerated by 'django-admin startproject' using Django 5.2.7.\n\nFor more information on this file, see\nhttps://docs.djangoproject.com/en/5.2/topics/settings/\n\nFor the full list of settings and their values, see\nhttps://docs.djangoproject.com/en/5.2/ref/settings/\n\"\"\"\n\nfrom pathlib import Path\n\n# Build paths inside the project like this: BASE_DIR / 'subdir'.\nBASE_DIR = Path(__file__).resolve().parent.parent\n\n\n# Quick-start development settings - unsuitable for production\n# See https://docs.djangoproject.com/en/5.2/howto/deployment/checklist/\n\n# SECURITY WARNING: keep the secret key used in production secret!\nSECRET_KEY = 'django-insecure-h-mxp^p+*m1%a588@#0%8po3c+hv3d5shemrqni8p$egj=v6p#'\n\n# SECURITY WARNING: don't run with debug turned on in production!\nDEBUG = True\n\nALLOWED_HOSTS = ['*']\n\n# CSRF Configuration\nimport os\nCSRF_TRUSTED_ORIGINS = [\n    'https://*.replit.dev',\n    'https://*.repl.co',\n    'http://localhost:5000',\n    'http://127.0.0.1:5000',\n]\n\n# Se houver REPLIT_DEV_DOMAIN, adicionar\nif os.environ.get('REPLIT_DEV_DOMAIN'):\n    CSRF_TRUSTED_ORIGINS.append(f\"https://{os.environ['REPLIT_DEV_DOMAIN']}\")\n\n# Application definition\n\nINSTALLED_APPS = [\n    'django.contrib.admin',\n    'django.contrib.auth',\n    'django.contrib.contenttypes',\n    'django.contrib.sessions',\n    'django.contrib.messages',\n    'django.contrib.staticfiles',\n    'core',\n]\n\nMIDDLEWARE = [\n    'django.middleware.security.SecurityMiddleware',\n    'django.contrib.sessions.middleware.SessionMiddleware',\n    'django.middleware.common.CommonMiddleware',\n    'django.middleware.csrf.CsrfViewMiddleware',\n    'django.contrib.auth.middleware.AuthenticationMiddleware',\n    'django.contrib.messages.middleware.MessageMiddleware',\n    'django.middleware.clickjacking.XFrameOptionsMiddleware',\n]\n\nROOT_URLCONF = 'escola_sistema.urls'\n\nTEMPLATES = [\n    {\n        'BACKEND': 'django.template.backends.django.DjangoTemplates',\n        'DIRS': [],\n        'APP_DIRS': True,\n        'OPTIONS': {\n            'context_processors': [\n                'django.template.context_processors.request',\n                'django.contrib.auth.context_processors.auth',\n                'django.contrib.messages.context_processors.messages',\n                'core.context_processors.subscricao_context',\n            ],\n        },\n    },\n]\n\nWSGI_APPLICATION = 'escola_sistema.wsgi.application'\n\n\n# Database\n# https://docs.djangoproject.com/en/5.2/ref/settings/#databases\n\nDATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.sqlite3',\n        'NAME': BASE_DIR / 'db.sqlite3',\n    }\n}\n\n\n# Password validation\n# https://docs.djangoproject.com/en/5.2/ref/settings/#auth-password-validators\n\nAUTH_PASSWORD_VALIDATORS = [\n    {\n        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',\n    },\n    {\n        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',\n    },\n    {\n        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',\n    },\n    {\n        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',\n    },\n]\n\n\n# Internationalization\n# https://docs.djangoproject.com/en/5.2/topics/i18n/\n\nLANGUAGE_CODE = 'pt-br'\n\nTIME_ZONE = 'Africa/Luanda'\n\nUSE_I18N = True\n\nUSE_TZ = True\n\n\n# Static files (CSS, JavaScript, Images)\n# https://docs.djangoproject.com/en/5.2/howto/static-files/\n\nSTATIC_URL = 'static/'\nSTATIC_ROOT = BASE_DIR / 'staticfiles'\nMEDIA_URL = 'media/'\nMEDIA_ROOT = BASE_DIR / 'media'\n\n# Default primary key field type\n# https://docs.djangoproject.com/en/5.2/ref/settings/#default-auto-field\n\nDEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'\n\n# Authentication Settings\nLOGIN_URL = '/login/'\nLOGIN_REDIRECT_URL = '/'\nLOGOUT_REDIRECT_URL = '/login/'\n","size_bytes":3799},"escola_sistema/urls.py":{"content":"from django.contrib import admin\nfrom django.urls import path\nfrom django.conf import settings\nfrom django.conf.urls.static import static\nfrom core import views\n\nurlpatterns = [\n    path('admin/', admin.site.urls),\n    path('', views.index, name='index'),\n    path('cursos/', views.cursos_lista, name='cursos_lista'),\n    path('cursos/novo/', views.curso_create, name='curso_create'),\n    path('cursos/<int:curso_id>/editar/', views.curso_edit, name='curso_edit'),\n    path('cursos/<int:curso_id>/toggle/', views.curso_toggle, name='curso_toggle'),\n    path('admissao/', views.admissao_estudantes, name='admissao_estudantes'),\n    path('admissao/inscricao/', views.admissao_inscricao, name='admissao_inscricao'),\n    path('inscricao/<int:curso_id>/', views.inscricao_create, name='inscricao_create'),\n    path('inscricao/consulta/<str:numero>/', views.inscricao_consulta, name='inscricao_consulta'),\n    path('inscricao/buscar/', views.inscricao_buscar, name='inscricao_buscar'),\n    path('inscricao/pdf/<str:numero>/', views.gerar_pdf_confirmacao, name='gerar_pdf'),\n    path('dashboard/', views.dashboard, name='dashboard'),\n    path('api/escolas/autocomplete/', views.escolas_autocomplete, name='escolas_autocomplete'),\n    path('api/escolas/create/', views.escola_create_ajax, name='escola_create_ajax'),\n    path('api/ano-academico/trocar/', views.trocar_ano_academico, name='trocar_ano_academico'),\n    path('login/', views.login_view, name='login'),\n    path('registro/', views.registro_view, name='registro'),\n    path('logout/', views.logout_view, name='logout'),\n    path('notificacoes/', views.notificacoes_view, name='notificacoes'),\n    path('notificacoes/<int:notificacao_id>/marcar-lida/', views.marcar_notificacao_lida, name='marcar_notificacao_lida'),\n    path('api/notificacoes/count/', views.get_notificacoes_count, name='notificacoes_count'),\n    path('api/perfis-pendentes/count/', views.get_perfis_pendentes_count, name='perfis_pendentes_count'),\n    path('renovar-subscricao/', views.renovar_subscricao_view, name='renovar_subscricao'),\n    path('esqueci-senha/', views.esqueci_senha_view, name='esqueci_senha'),\n    path('validar-otp/', views.validar_otp_view, name='validar_otp'),\n    path('redefinir-senha/<str:token>/', views.redefinir_senha_email_view, name='redefinir_senha_email'),\n    path('perfis-pendentes/', views.perfis_pendentes_view, name='perfis_pendentes'),\n    path('atribuir-perfil/<int:perfil_id>/', views.atribuir_perfil_view, name='atribuir_perfil'),\n]\n\nif settings.DEBUG:\n    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)\n","size_bytes":2598},"escola_sistema/wsgi.py":{"content":"\"\"\"\nWSGI config for escola_sistema project.\n\nIt exposes the WSGI callable as a module-level variable named ``application``.\n\nFor more information on this file, see\nhttps://docs.djangoproject.com/en/5.2/howto/deployment/wsgi/\n\"\"\"\n\nimport os\n\nfrom django.core.wsgi import get_wsgi_application\n\nos.environ.setdefault('DJANGO_SETTINGS_MODULE', 'escola_sistema.settings')\n\napplication = get_wsgi_application()\n","size_bytes":405},"core/migrations/0001_initial.py":{"content":"# Generated by Django 5.2.7 on 2025-10-07 01:07\n\nimport django.core.validators\nimport django.db.models.deletion\nimport django.utils.timezone\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    initial = True\n\n    dependencies = [\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='ConfiguracaoEscola',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('nome_escola', models.CharField(max_length=200, verbose_name='Nome da Escola')),\n                ('endereco', models.TextField(blank=True, verbose_name='Endereço')),\n                ('telefone', models.CharField(blank=True, max_length=20, verbose_name='Telefone')),\n                ('email', models.EmailField(blank=True, max_length=254, verbose_name='Email')),\n                ('logo', models.ImageField(blank=True, null=True, upload_to='escola/', verbose_name='Logo da Escola')),\n                ('template_confirmacao_inscricao', models.TextField(default='CONFIRMAÇÃO DE INSCRIÇÃO\\n\\nNome: {nome}\\nCurso: {curso}\\nNúmero de Inscrição: {numero}\\nData: {data}', help_text='Use {nome}, {curso}, {numero}, {data} para campos dinâmicos', verbose_name='Template de Confirmação de Inscrição')),\n            ],\n            options={\n                'verbose_name': 'Configuração da Escola',\n                'verbose_name_plural': 'Configurações da Escola',\n            },\n        ),\n        migrations.CreateModel(\n            name='Curso',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('nome', models.CharField(max_length=200, verbose_name='Nome do Curso')),\n                ('descricao', models.TextField(blank=True, verbose_name='Descrição')),\n                ('vagas', models.PositiveIntegerField(verbose_name='Número de Vagas')),\n                ('nota_minima', models.DecimalField(decimal_places=2, default=10.0, max_digits=4, validators=[django.core.validators.MinValueValidator(10.0), django.core.validators.MaxValueValidator(20.0)], verbose_name='Nota Mínima para Aprovação')),\n                ('ativo', models.BooleanField(default=True, verbose_name='Ativo')),\n                ('data_criacao', models.DateTimeField(auto_now_add=True)),\n            ],\n            options={\n                'verbose_name': 'Curso',\n                'verbose_name_plural': 'Cursos',\n                'ordering': ['nome'],\n            },\n        ),\n        migrations.CreateModel(\n            name='Aluno',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('nome_completo', models.CharField(max_length=200, verbose_name='Nome Completo')),\n                ('numero_estudante', models.CharField(max_length=20, unique=True, verbose_name='Número de Estudante')),\n                ('bilhete_identidade', models.CharField(max_length=50, verbose_name='Bilhete de Identidade')),\n                ('data_nascimento', models.DateField(verbose_name='Data de Nascimento')),\n                ('sexo', models.CharField(choices=[('M', 'Masculino'), ('F', 'Feminino')], max_length=1, verbose_name='Sexo')),\n                ('telefone', models.CharField(max_length=20, verbose_name='Telefone')),\n                ('email', models.EmailField(max_length=254, verbose_name='Email')),\n                ('endereco', models.TextField(verbose_name='Endereço')),\n                ('data_matricula', models.DateField(default=django.utils.timezone.now, verbose_name='Data de Matrícula')),\n                ('user', models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),\n            ],\n            options={\n                'verbose_name': 'Aluno',\n                'verbose_name_plural': 'Alunos',\n                'ordering': ['nome_completo'],\n            },\n        ),\n        migrations.CreateModel(\n            name='Disciplina',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('nome', models.CharField(max_length=200, verbose_name='Nome da Disciplina')),\n                ('carga_horaria', models.PositiveIntegerField(default=40, verbose_name='Carga Horária (horas)')),\n                ('descricao', models.TextField(blank=True, verbose_name='Descrição')),\n                ('curso', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='disciplinas', to='core.curso', verbose_name='Curso')),\n            ],\n            options={\n                'verbose_name': 'Disciplina',\n                'verbose_name_plural': 'Disciplinas',\n                'ordering': ['curso', 'nome'],\n            },\n        ),\n        migrations.CreateModel(\n            name='Inscricao',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('numero_inscricao', models.CharField(max_length=20, unique=True, verbose_name='Número de Inscrição')),\n                ('nome_completo', models.CharField(max_length=200, verbose_name='Nome Completo')),\n                ('data_nascimento', models.DateField(verbose_name='Data de Nascimento')),\n                ('sexo', models.CharField(choices=[('M', 'Masculino'), ('F', 'Feminino')], max_length=1, verbose_name='Sexo')),\n                ('bilhete_identidade', models.CharField(max_length=50, verbose_name='Bilhete de Identidade')),\n                ('telefone', models.CharField(max_length=20, verbose_name='Telefone')),\n                ('email', models.EmailField(max_length=254, verbose_name='Email')),\n                ('endereco', models.TextField(verbose_name='Endereço')),\n                ('nota_teste', models.DecimalField(blank=True, decimal_places=2, max_digits=4, null=True, validators=[django.core.validators.MinValueValidator(0.0), django.core.validators.MaxValueValidator(20.0)], verbose_name='Nota do Teste (0-20)')),\n                ('aprovado', models.BooleanField(default=False, verbose_name='Aprovado')),\n                ('data_inscricao', models.DateTimeField(auto_now_add=True, verbose_name='Data de Inscrição')),\n                ('data_resultado', models.DateTimeField(blank=True, null=True, verbose_name='Data do Resultado')),\n                ('curso', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='inscricoes', to='core.curso', verbose_name='Curso')),\n            ],\n            options={\n                'verbose_name': 'Inscrição',\n                'verbose_name_plural': 'Inscrições',\n                'ordering': ['-data_inscricao'],\n            },\n        ),\n        migrations.CreateModel(\n            name='Pai',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('nome_completo', models.CharField(max_length=200, verbose_name='Nome Completo')),\n                ('bilhete_identidade', models.CharField(max_length=50, verbose_name='Bilhete de Identidade')),\n                ('telefone', models.CharField(max_length=20, verbose_name='Telefone')),\n                ('email', models.EmailField(blank=True, max_length=254, verbose_name='Email')),\n                ('endereco', models.TextField(verbose_name='Endereço')),\n                ('parentesco', models.CharField(max_length=50, verbose_name='Parentesco (Pai, Mãe, Tutor, etc.)')),\n                ('alunos', models.ManyToManyField(related_name='pais', to='core.aluno', verbose_name='Alunos')),\n            ],\n            options={\n                'verbose_name': 'Pai/Responsável',\n                'verbose_name_plural': 'Pais/Responsáveis',\n                'ordering': ['nome_completo'],\n            },\n        ),\n        migrations.CreateModel(\n            name='Professor',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('nome_completo', models.CharField(max_length=200, verbose_name='Nome Completo')),\n                ('bilhete_identidade', models.CharField(max_length=50, verbose_name='Bilhete de Identidade')),\n                ('data_nascimento', models.DateField(verbose_name='Data de Nascimento')),\n                ('sexo', models.CharField(choices=[('M', 'Masculino'), ('F', 'Feminino')], max_length=1, verbose_name='Sexo')),\n                ('telefone', models.CharField(max_length=20, verbose_name='Telefone')),\n                ('email', models.EmailField(max_length=254, verbose_name='Email')),\n                ('endereco', models.TextField(verbose_name='Endereço')),\n                ('especialidade', models.CharField(max_length=200, verbose_name='Especialidade')),\n                ('data_contratacao', models.DateField(default=django.utils.timezone.now, verbose_name='Data de Contratação')),\n                ('user', models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),\n            ],\n            options={\n                'verbose_name': 'Professor',\n                'verbose_name_plural': 'Professores',\n                'ordering': ['nome_completo'],\n            },\n        ),\n        migrations.CreateModel(\n            name='Turma',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('nome', models.CharField(max_length=100, verbose_name='Nome da Turma')),\n                ('ano_letivo', models.CharField(max_length=9, verbose_name='Ano Letivo (ex: 2024/2025)')),\n                ('curso', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='turmas', to='core.curso', verbose_name='Curso')),\n                ('professor_titular', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.professor', verbose_name='Professor Titular')),\n            ],\n            options={\n                'verbose_name': 'Turma',\n                'verbose_name_plural': 'Turmas',\n                'ordering': ['ano_letivo', 'nome'],\n            },\n        ),\n        migrations.AddField(\n            model_name='aluno',\n            name='turma',\n            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='alunos', to='core.turma', verbose_name='Turma'),\n        ),\n    ]\n","size_bytes":10733},"core/migrations/0002_alter_inscricao_numero_inscricao.py":{"content":"# Generated by Django 5.2.7 on 2025-10-07 01:09\n\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0001_initial'),\n    ]\n\n    operations = [\n        migrations.AlterField(\n            model_name='inscricao',\n            name='numero_inscricao',\n            field=models.CharField(blank=True, max_length=20, unique=True, verbose_name='Número de Inscrição'),\n        ),\n    ]\n","size_bytes":449},"core/migrations/0003_inscricao_ano_conclusao_and_more.py":{"content":"# Generated by Django 5.2.7 on 2025-10-07 02:21\n\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0002_alter_inscricao_numero_inscricao'),\n    ]\n\n    operations = [\n        migrations.AddField(\n            model_name='inscricao',\n            name='ano_conclusao',\n            field=models.CharField(default='2024', max_length=4, verbose_name='Ano de Conclusão'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='certificados_obtidos',\n            field=models.TextField(blank=True, default='', verbose_name='Certificados/Diplomas Obtidos'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='comprovativo_pagamento',\n            field=models.FileField(blank=True, null=True, upload_to='inscricoes/pagamentos/', verbose_name='Comprovativo de Pagamento'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='doc_bi',\n            field=models.FileField(blank=True, null=True, upload_to='inscricoes/documentos/', verbose_name='Cópia do BI/Passaporte'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='doc_boletim',\n            field=models.FileField(blank=True, null=True, upload_to='inscricoes/documentos/', verbose_name='Boletim de Notas'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='doc_certificado',\n            field=models.FileField(blank=True, null=True, upload_to='inscricoes/documentos/', verbose_name='Certificado de Conclusão'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='doc_comprovativo_residencia',\n            field=models.FileField(blank=True, null=True, upload_to='inscricoes/documentos/', verbose_name='Comprovativo de Residência'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='doc_fotografia',\n            field=models.ImageField(blank=True, null=True, upload_to='inscricoes/fotos/', verbose_name='Fotografia Tipo Passe'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='encarregado_email',\n            field=models.EmailField(blank=True, max_length=254, verbose_name='Email do Encarregado'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='encarregado_local_trabalho',\n            field=models.CharField(blank=True, max_length=200, verbose_name='Local de Trabalho do Encarregado'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='encarregado_nome',\n            field=models.CharField(blank=True, max_length=200, verbose_name='Nome do Encarregado de Educação'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='encarregado_parentesco',\n            field=models.CharField(blank=True, max_length=100, verbose_name='Grau de Parentesco'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='encarregado_profissao',\n            field=models.CharField(blank=True, max_length=200, verbose_name='Profissão do Encarregado'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='encarregado_telefone',\n            field=models.CharField(blank=True, max_length=20, verbose_name='Telefone do Encarregado'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='estado_civil',\n            field=models.CharField(choices=[('S', 'Solteiro(a)'), ('C', 'Casado(a)'), ('D', 'Divorciado(a)'), ('V', 'Viúvo(a)')], default='S', max_length=1, verbose_name='Estado Civil'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='historico_escolar',\n            field=models.TextField(blank=True, default='', verbose_name='Notas/Histórico Escolar'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='local_nascimento',\n            field=models.CharField(default='Luanda', max_length=200, verbose_name='Local de Nascimento'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='nacionalidade',\n            field=models.CharField(default='Angolana', max_length=100, verbose_name='Nacionalidade'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='responsavel_financeiro_nome',\n            field=models.CharField(blank=True, max_length=200, verbose_name='Nome do Responsável Financeiro'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='responsavel_financeiro_relacao',\n            field=models.CharField(blank=True, max_length=100, verbose_name='Relação com o Estudante'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='responsavel_financeiro_telefone',\n            field=models.CharField(blank=True, max_length=20, verbose_name='Telefone do Responsável Financeiro'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='turno_preferencial',\n            field=models.CharField(choices=[('M', 'Manhã'), ('T', 'Tarde'), ('N', 'Noite')], default='M', max_length=1, verbose_name='Turno Preferencial'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='ultima_escola',\n            field=models.CharField(default='', max_length=200, verbose_name='Última Escola Frequentada'),\n        ),\n        migrations.AlterField(\n            model_name='inscricao',\n            name='endereco',\n            field=models.TextField(verbose_name='Endereço Completo'),\n        ),\n    ]\n","size_bytes":5822},"core/migrations/0004_escola_remove_inscricao_comprovativo_pagamento_and_more.py":{"content":"# Generated by Django 5.2.7 on 2025-10-07 02:34\n\nimport django.db.models.deletion\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0003_inscricao_ano_conclusao_and_more'),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='Escola',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('nome', models.CharField(max_length=300, unique=True, verbose_name='Nome da Escola')),\n                ('municipio', models.CharField(blank=True, max_length=100, verbose_name='Município')),\n                ('provincia', models.CharField(blank=True, max_length=100, verbose_name='Província')),\n                ('tipo', models.CharField(choices=[('Pública', 'Pública'), ('Privada', 'Privada')], default='Pública', max_length=20, verbose_name='Tipo')),\n                ('data_cadastro', models.DateTimeField(auto_now_add=True)),\n            ],\n            options={\n                'verbose_name': 'Escola',\n                'verbose_name_plural': 'Escolas',\n                'ordering': ['nome'],\n            },\n        ),\n        migrations.RemoveField(\n            model_name='inscricao',\n            name='comprovativo_pagamento',\n        ),\n        migrations.RemoveField(\n            model_name='inscricao',\n            name='doc_bi',\n        ),\n        migrations.RemoveField(\n            model_name='inscricao',\n            name='doc_boletim',\n        ),\n        migrations.RemoveField(\n            model_name='inscricao',\n            name='doc_certificado',\n        ),\n        migrations.RemoveField(\n            model_name='inscricao',\n            name='doc_comprovativo_residencia',\n        ),\n        migrations.RemoveField(\n            model_name='inscricao',\n            name='doc_fotografia',\n        ),\n        migrations.RemoveField(\n            model_name='inscricao',\n            name='ultima_escola',\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='data_validade_bi',\n            field=models.DateField(blank=True, null=True, verbose_name='Data de Validade do BI'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='numero_comprovante',\n            field=models.CharField(blank=True, max_length=100, verbose_name='Número do Comprovante/Boleto'),\n        ),\n        migrations.AlterField(\n            model_name='inscricao',\n            name='bilhete_identidade',\n            field=models.CharField(max_length=50, verbose_name='Número do Bilhete de Identidade'),\n        ),\n        migrations.AddField(\n            model_name='inscricao',\n            name='escola',\n            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='inscricoes', to='core.escola', verbose_name='Última Escola Frequentada'),\n        ),\n    ]\n","size_bytes":2974},"core/migrations/__init__.py":{"content":"","size_bytes":0},"core/context_processors.py":{"content":"from .models import Subscricao, ConfiguracaoEscola\n\ndef subscricao_context(request):\n    \"\"\"Context processor para adicionar informações de subscrição em todos os templates\"\"\"\n    subscricao = Subscricao.objects.filter(estado__in=['ativo', 'teste']).first()\n    config = ConfiguracaoEscola.objects.first()\n    \n    return {\n        'subscricao': subscricao,\n        'config': config,\n        'versao_sistema': '1.0.0',\n        'desenvolvedor': 'Eng. Osvaldo Queta'\n    }\n","size_bytes":475},"core/migrations/0005_anoacademico.py":{"content":"# Generated by Django 5.2.7 on 2025-10-07 03:06\n\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0004_escola_remove_inscricao_comprovativo_pagamento_and_more'),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='AnoAcademico',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('ano_inicio', models.IntegerField(verbose_name='Ano de Início')),\n                ('ano_fim', models.IntegerField(verbose_name='Ano de Fim')),\n                ('ativo', models.BooleanField(default=False, verbose_name='Ano Ativo')),\n                ('data_criacao', models.DateTimeField(auto_now_add=True)),\n            ],\n            options={\n                'verbose_name': 'Ano Acadêmico',\n                'verbose_name_plural': 'Anos Acadêmicos',\n                'ordering': ['-ano_inicio'],\n                'unique_together': {('ano_inicio', 'ano_fim')},\n            },\n        ),\n    ]\n","size_bytes":1077},"core/migrations/0006_notificacao_perfilusuario.py":{"content":"# Generated by Django 5.2.7 on 2025-10-07 03:26\n\nimport django.db.models.deletion\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0005_anoacademico'),\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='Notificacao',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('titulo', models.CharField(max_length=200, verbose_name='Título')),\n                ('mensagem', models.TextField(verbose_name='Mensagem')),\n                ('tipo', models.CharField(choices=[('info', 'Informação'), ('aviso', 'Aviso'), ('urgente', 'Urgente'), ('sucesso', 'Sucesso')], default='info', max_length=20, verbose_name='Tipo')),\n                ('data_criacao', models.DateTimeField(auto_now_add=True, verbose_name='Data de Criação')),\n                ('global_notificacao', models.BooleanField(default=False, help_text='Se marcado, todos os usuários verão esta notificação', verbose_name='Notificação Global')),\n                ('ativa', models.BooleanField(default=True, verbose_name='Ativa')),\n                ('destinatarios', models.ManyToManyField(blank=True, related_name='notificacoes', to=settings.AUTH_USER_MODEL, verbose_name='Destinatários')),\n                ('lida_por', models.ManyToManyField(blank=True, related_name='notificacoes_lidas', to=settings.AUTH_USER_MODEL, verbose_name='Lida por')),\n            ],\n            options={\n                'verbose_name': 'Notificação',\n                'verbose_name_plural': 'Notificações',\n                'ordering': ['-data_criacao'],\n            },\n        ),\n        migrations.CreateModel(\n            name='PerfilUsuario',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('nivel_acesso', models.CharField(choices=[('admin', 'Administrador'), ('secretaria', 'Secretaria'), ('professor', 'Professor'), ('coordenador', 'Coordenador'), ('aluno', 'Aluno')], default='aluno', max_length=20, verbose_name='Nível de Acesso')),\n                ('telefone', models.CharField(blank=True, max_length=20, verbose_name='Telefone')),\n                ('foto', models.ImageField(blank=True, null=True, upload_to='usuarios/', verbose_name='Foto')),\n                ('data_cadastro', models.DateTimeField(auto_now_add=True, verbose_name='Data de Cadastro')),\n                ('ativo', models.BooleanField(default=True, verbose_name='Ativo')),\n                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='perfil', to=settings.AUTH_USER_MODEL, verbose_name='Usuário')),\n            ],\n            options={\n                'verbose_name': 'Perfil de Usuário',\n                'verbose_name_plural': 'Perfis de Usuários',\n                'ordering': ['user__username'],\n            },\n        ),\n    ]\n","size_bytes":3098},"core/migrations/0007_subscricao.py":{"content":"# Generated by Django 5.2.7 on 2025-10-07 03:45\n\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0006_notificacao_perfilusuario'),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='Subscricao',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('nome_escola', models.CharField(max_length=200, unique=True, verbose_name='Nome da Escola')),\n                ('plano', models.CharField(choices=[('mensal', 'Mensal'), ('trimestral', 'Trimestral'), ('semestral', 'Semestral'), ('anual', 'Anual')], default='mensal', max_length=20, verbose_name='Plano')),\n                ('data_inicio', models.DateField(verbose_name='Data de Início')),\n                ('data_expiracao', models.DateField(verbose_name='Data de Expiração')),\n                ('estado', models.CharField(choices=[('ativo', 'Ativo'), ('expirado', 'Expirado'), ('cancelado', 'Cancelado'), ('teste', 'Período de Teste')], default='teste', max_length=20, verbose_name='Estado')),\n                ('valor_pago', models.DecimalField(decimal_places=2, default=0.0, max_digits=10, verbose_name='Valor Pago')),\n                ('observacoes', models.TextField(blank=True, verbose_name='Observações')),\n                ('data_criacao', models.DateTimeField(auto_now_add=True)),\n            ],\n            options={\n                'verbose_name': 'Subscrição',\n                'verbose_name_plural': 'Subscrições',\n                'ordering': ['-data_inicio'],\n            },\n        ),\n    ]\n","size_bytes":1657},"core/migrations/0008_pagamentosubscricao.py":{"content":"# Generated by Django 5.2.7 on 2025-10-07 03:55\n\nimport django.db.models.deletion\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0007_subscricao'),\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='PagamentoSubscricao',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('plano_escolhido', models.CharField(choices=[('mensal', 'Mensal'), ('trimestral', 'Trimestral'), ('semestral', 'Semestral'), ('anual', 'Anual')], default='mensal', max_length=20, verbose_name='Plano Escolhido')),\n                ('valor', models.DecimalField(decimal_places=2, max_digits=10, verbose_name='Valor Pago')),\n                ('comprovante', models.FileField(upload_to='comprovantes/', verbose_name='Comprovante de Pagamento')),\n                ('numero_referencia', models.CharField(blank=True, max_length=100, verbose_name='Número de Referência')),\n                ('status', models.CharField(choices=[('pendente', 'Pendente'), ('aprovado', 'Aprovado'), ('rejeitado', 'Rejeitado')], default='pendente', max_length=20, verbose_name='Status')),\n                ('data_pagamento', models.DateField(verbose_name='Data do Pagamento')),\n                ('data_submissao', models.DateTimeField(auto_now_add=True, verbose_name='Data de Submissão')),\n                ('observacoes', models.TextField(blank=True, verbose_name='Observações')),\n                ('data_aprovacao', models.DateTimeField(blank=True, null=True, verbose_name='Data de Aprovação')),\n                ('recibo_pdf', models.FileField(blank=True, null=True, upload_to='recibos/', verbose_name='Recibo PDF')),\n                ('aprovado_por', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='pagamentos_aprovados', to=settings.AUTH_USER_MODEL, verbose_name='Aprovado Por')),\n                ('subscricao', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='pagamentos', to='core.subscricao', verbose_name='Subscrição')),\n            ],\n            options={\n                'verbose_name': 'Pagamento de Subscrição',\n                'verbose_name_plural': 'Pagamentos de Subscrição',\n                'ordering': ['-data_submissao'],\n            },\n        ),\n    ]\n","size_bytes":2506},"core/migrations/0009_recuperacaosenha.py":{"content":"# Generated by Django 5.2.7 on 2025-10-07 04:02\n\nimport django.db.models.deletion\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0008_pagamentosubscricao'),\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='RecuperacaoSenha',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('tipo', models.CharField(choices=[('email', 'Email'), ('telefone', 'Telefone')], max_length=20, verbose_name='Tipo de Recuperação')),\n                ('codigo_otp', models.CharField(blank=True, max_length=6, verbose_name='Código OTP')),\n                ('token', models.CharField(blank=True, max_length=100, verbose_name='Token de Recuperação')),\n                ('email_enviado', models.EmailField(blank=True, max_length=254, verbose_name='Email Enviado Para')),\n                ('telefone_enviado', models.CharField(blank=True, max_length=20, verbose_name='Telefone Enviado Para')),\n                ('usado', models.BooleanField(default=False, verbose_name='Usado')),\n                ('data_criacao', models.DateTimeField(auto_now_add=True, verbose_name='Data de Criação')),\n                ('data_expiracao', models.DateTimeField(verbose_name='Data de Expiração')),\n                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='recuperacoes_senha', to=settings.AUTH_USER_MODEL, verbose_name='Usuário')),\n            ],\n            options={\n                'verbose_name': 'Recuperação de Senha',\n                'verbose_name_plural': 'Recuperações de Senha',\n                'ordering': ['-data_criacao'],\n            },\n        ),\n    ]\n","size_bytes":1880},"core/signals.py":{"content":"from django.db.models.signals import post_save\nfrom django.dispatch import receiver\nfrom django.contrib.auth.models import User\nfrom .models import PerfilUsuario\n\n@receiver(post_save, sender=User)\ndef criar_perfil_usuario(sender, instance, created, **kwargs):\n    if created:\n        PerfilUsuario.objects.create(user=instance, nivel_acesso='pendente')\n\n@receiver(post_save, sender=User)\ndef salvar_perfil_usuario(sender, instance, **kwargs):\n    if hasattr(instance, 'perfil'):\n        instance.perfil.save()\n","size_bytes":510},"core/utils.py":{"content":"from reportlab.lib.pagesizes import A4\nfrom reportlab.lib import colors\nfrom reportlab.lib.units import cm\nfrom reportlab.platypus import SimpleDocTemplate, Table, TableStyle, Paragraph, Spacer, Image\nfrom reportlab.lib.styles import getSampleStyleSheet, ParagraphStyle\nfrom reportlab.lib.enums import TA_CENTER, TA_RIGHT\nfrom django.core.files.base import ContentFile\nfrom io import BytesIO\nfrom datetime import datetime\nimport os\n\ndef gerar_recibo_pagamento(pagamento):\n    \"\"\"Gera um recibo PDF para um pagamento aprovado\"\"\"\n    from .models import ConfiguracaoEscola\n    from django.conf import settings\n    \n    buffer = BytesIO()\n    doc = SimpleDocTemplate(buffer, pagesize=A4)\n    elements = []\n    styles = getSampleStyleSheet()\n    \n    config = ConfiguracaoEscola.objects.first()\n    \n    logo_path = os.path.join(settings.BASE_DIR, 'core', 'static', 'core', 'images', 'siga-logo.png')\n    if os.path.exists(logo_path):\n        img = Image(logo_path, width=4*cm, height=1.5*cm)\n        elements.append(img)\n        elements.append(Spacer(1, 0.5*cm))\n    \n    title_style = ParagraphStyle(\n        'CustomTitle',\n        parent=styles['Heading1'],\n        fontSize=18,\n        textColor=colors.HexColor('#1e3a8a'),\n        spaceAfter=30,\n        alignment=TA_CENTER\n    )\n    \n    elements.append(Paragraph(f\"RECIBO DE PAGAMENTO\", title_style))\n    elements.append(Paragraph(f\"Nº {pagamento.id:06d}\", styles['Normal']))\n    elements.append(Spacer(1, 0.5*cm))\n    \n    data = [\n        ['Escola:', pagamento.subscricao.nome_escola],\n        ['Plano:', pagamento.get_plano_escolhido_display()],\n        ['Valor Pago:', f\"{pagamento.valor:,.2f} Kz\"],\n        ['Data do Pagamento:', pagamento.data_pagamento.strftime('%d/%m/%Y')],\n        ['Referência:', pagamento.numero_referencia or 'N/A'],\n        ['Aprovado Por:', pagamento.aprovado_por.get_full_name() or pagamento.aprovado_por.username],\n        ['Data de Aprovação:', pagamento.data_aprovacao.strftime('%d/%m/%Y %H:%M')],\n        ['Nova Data de Expiração:', pagamento.subscricao.data_expiracao.strftime('%d/%m/%Y')],\n    ]\n    \n    table = Table(data, colWidths=[6*cm, 12*cm])\n    table.setStyle(TableStyle([\n        ('BACKGROUND', (0, 0), (0, -1), colors.HexColor('#e5e7eb')),\n        ('TEXTCOLOR', (0, 0), (-1, -1), colors.black),\n        ('ALIGN', (0, 0), (-1, -1), 'LEFT'),\n        ('FONTNAME', (0, 0), (0, -1), 'Helvetica-Bold'),\n        ('FONTSIZE', (0, 0), (-1, -1), 12),\n        ('BOTTOMPADDING', (0, 0), (-1, -1), 12),\n        ('TOPPADDING', (0, 0), (-1, -1), 12),\n        ('GRID', (0, 0), (-1, -1), 1, colors.grey)\n    ]))\n    \n    elements.append(table)\n    elements.append(Spacer(1, 1*cm))\n    \n    elements.append(Paragraph(\"Este recibo confirma o pagamento e renovação da subscrição do SIGA.\", styles['Normal']))\n    elements.append(Spacer(1, 0.5*cm))\n    elements.append(Paragraph(f\"Gerado em: {datetime.now().strftime('%d/%m/%Y às %H:%M')}\", styles['Normal']))\n    \n    footer_style = ParagraphStyle(\n        'Footer',\n        parent=styles['Normal'],\n        fontSize=10,\n        textColor=colors.grey,\n        alignment=TA_CENTER\n    )\n    elements.append(Spacer(1, 1*cm))\n    elements.append(Paragraph(\"SIGA v1.0.0 - Sistema Integral de Gestão Académica\", footer_style))\n    elements.append(Paragraph(\"Desenvolvido por Eng. Osvaldo Queta\", footer_style))\n    \n    doc.build(elements)\n    \n    pdf_content = ContentFile(buffer.getvalue())\n    filename = f'recibo_pagamento_{pagamento.id}_{datetime.now().strftime(\"%Y%m%d_%H%M%S\")}.pdf'\n    \n    pagamento.recibo_pdf.save(filename, pdf_content, save=False)\n    \n    return filename\n","size_bytes":3627},"core/migrations/0010_alter_perfilusuario_nivel_acesso.py":{"content":"# Generated by Django 5.2.7 on 2025-10-07 04:15\n\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('core', '0009_recuperacaosenha'),\n    ]\n\n    operations = [\n        migrations.AlterField(\n            model_name='perfilusuario',\n            name='nivel_acesso',\n            field=models.CharField(choices=[('pendente', 'Pendente de Aprovação'), ('admin', 'Administrador'), ('secretaria', 'Secretaria'), ('professor', 'Professor'), ('coordenador', 'Coordenador'), ('aluno', 'Aluno')], default='pendente', max_length=20, verbose_name='Nível de Acesso'),\n        ),\n    ]\n","size_bytes":636}},"version":1}